<template><div><h1 id="spring-bean-å‡ºç”Ÿç¯‡-ä¸€" tabindex="-1"><a class="header-anchor" href="#spring-bean-å‡ºç”Ÿç¯‡-ä¸€"><span>Spring Bean å‡ºç”Ÿç¯‡(ä¸€)</span></a></h1>
<h2 id="ç›®å½•" tabindex="-1"><a class="header-anchor" href="#ç›®å½•"><span>ç›®å½•</span></a></h2>
<ul>
<li><a href="#Bean%E7%9A%84%E7%94%9F%E4%BA%A7%E5%9B%BE%E7%BA%B8-BeanDefinition">Bean çš„ç”Ÿäº§å›¾çº¸ BeanDefinition</a>
<ul>
<li><a href="#%E5%AE%9A%E4%BD%8DBeanDefinition%E5%85%83%E6%95%B0%E6%8D%AE%E4%BF%A1%E6%81%AF">å®šä½ BeanDefinition å…ƒæ•°æ®ä¿¡æ¯</a>
<ul>
<li><a href="#supportAbstractBeanDefinitionReaderloadBeanDefinitionsjavalangString-javautilSetorgspringframeworkcoreioResource">support.AbstractBeanDefinitionReader#loadBeanDefinitions(java.lang.String, java.util.Set&lt;org.springframework.core.io.Resource&gt;)</a></li>
<li><a href="#ResourcePatternResolver%E5%B7%A5%E5%85%B7%E7%B1%BB">ResourcePatternResolver å·¥å…·ç±»</a></li>
</ul>
</li>
<li><a href="#%E5%8A%A0%E8%BD%BDBeanDefinition">åŠ è½½ BeanDefinition</a>
<ul>
<li><a href="#%E8%B5%84%E6%BA%90%E5%87%86%E5%A4%87">èµ„æºå‡†å¤‡</a>
<ul>
<li><a href="#xmlXmlBeanDefinitionReaderloadBeanDefinitionsorgspringframeworkcoreiosupportEncodedResource">xml.XmlBeanDefinitionReader#loadBeanDefinitions(org.springframework.core.io.support.EncodedResource)</a></li>
</ul>
</li>
<li><a href="#%E6%89%A7%E8%A1%8C%E5%8A%A0%E8%BD%BDBeanDefinition">æ‰§è¡ŒåŠ è½½ BeanDefinition</a>
<ul>
<li><a href="#xmlXmlBeanDefinitionReaderdoLoadBeanDefinitions">xml.XmlBeanDefinitionReader#doLoadBeanDefinitions</a>
<ul>
<li><a href="#DocumentLoader">DocumentLoader</a></li>
<li><a href="#DefaultDocumentLoader-%E7%9A%84%E4%BD%BF%E7%94%A8%E6%A1%88%E4%BE%8B">DefaultDocumentLoader çš„ä½¿ç”¨æ¡ˆä¾‹</a></li>
</ul>
</li>
<li><a href="#XmlBeanDefinitionReaderdoLoadBeanDefinitions">XmlBeanDefinitionReader#doLoadBeanDefinitions()</a></li>
</ul>
</li>
<li><a href="#%E8%A7%A3%E6%9E%90BeanDefinition">è§£æ BeanDefinition</a>
<ul>
<li><a href="#XmlBeanDefinitionReaderregisterBeanDefinitions">XmlBeanDefinitionReader#registerBeanDefinitions()</a></li>
<li><a href="#Spring%E6%8F%90%E4%BE%9B%E7%9A%84%E5%8F%8D%E5%B0%84%E5%B7%A5%E5%85%B7%E7%B1%BBBeanUtilsinstantiateClass">Spring æä¾›çš„åå°„å·¥å…·ç±» BeanUtils.instantiateClass</a></li>
<li><a href="#DefaultBeanDefinitionDocumentReaderdoRegisterBeanDefinitions">DefaultBeanDefinitionDocumentReader#doRegisterBeanDefinitions</a></li>
<li><a href="#BeanDefinitionParserDelegate">BeanDefinitionParserDelegate</a>
<ul>
<li><a href="#xmlBeanDefinitionParserDelegateparseBeanDefinitionElementorgw3cdomElement-orgspringframeworkbeansfactoryconfigBeanDefinition">xml.BeanDefinitionParserDelegate#parseBeanDefinitionElement(org.w3c.dom.Element, org.springframework.beans.factory.config.BeanDefinition)</a></li>
</ul>
</li>
<li><a href="#DefaultBeanDefinitionDocumentReaderparseBeanDefinitions">DefaultBeanDefinitionDocumentReader#parseBeanDefinitions</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#BeanDefinition%E6%B3%A8%E5%86%8C%E8%87%B3IOC%E5%AE%B9%E5%99%A8">BeanDefinition æ³¨å†Œè‡³ IOC å®¹å™¨</a>
<ul>
<li><a href="#BeanDefinitionReaderUtilsregisterBeanDefinition">BeanDefinitionReaderUtils#registerBeanDefinition</a></li>
<li><a href="#DefaultListableBeanFactoryregisterBeanDefinition">DefaultListableBeanFactory#registerBeanDefinition</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E6%80%BB%E7%BB%93">æ€»ç»“</a></li>
</ul>
<p>ä» IOC ç¯‡ï¼Œæˆ‘ä»¬å·²ç»æ¸…æ¥šäº† Bean å’Œ å®¹å™¨é—´çš„å…³ç³»äº†ï¼Œæˆ‘ä»¬è¯´å®¹å™¨åƒä¸€ä¸ªåœ°çƒæ‘ï¼Œè€Œ Bean åƒä¸€ä¸ªä¸ªå±…æ°‘ï¼Œè€Œä¸” Bean è¿˜å…·æœ‰ç€ BeanDefinition ç»™ä»–æ ‡è¯†èº«ä»½å’Œç‰¹æ€§ï¼Œå°±åƒèº«ä»½è¯ä¸€æ ·ã€‚åœ¨ IOC ç¯‡ï¼Œæˆ‘ä»¬æ›´æ˜¯é€šè¿‡ xml çš„æ–¹å¼å®šä¹‰äº† Bean çš„ä¿¡æ¯ï¼Œå½“æˆ‘ä»¬åˆ›å»º ApplicationContext å®¹å™¨ ClassPathXmlApplicationContext æ—¶ï¼Œæˆ‘ä»¬å®šä¹‰çš„ Bean ä¿¡æ¯ä¾¿ä¼šè¢«åŠ è½½æˆ Beanï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡ getBean æ–¹æ³•è·å–åˆ°å¯¹åº”çš„ Beanã€‚</p>
<p>å½“ç„¶ï¼Œæˆ‘ä»¬è¿˜äº†è§£äº† IOC å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸçš„è„‰ç»œï¼Œé‚£ä¹ˆè¯¥ç¯‡ï¼Œæˆ‘ä»¬å°±ä¸€èµ·åˆ†æåˆ†ææˆ‘ä»¬å®šä¹‰çš„è¿™ä¹ˆäº› Bean ä¿¡æ¯æ˜¯å¦‚ä½•ä» xml ä¸­åˆ°è¾¾å®¹å™¨å†…éƒ¨å½¢æˆä¸€ä¸ª Bean çš„ã€‚</p>
<h3 id="bean-çš„ç”Ÿäº§å›¾çº¸-beandefinition" tabindex="-1"><a class="header-anchor" href="#bean-çš„ç”Ÿäº§å›¾çº¸-beandefinition"><span>Bean çš„ç”Ÿäº§å›¾çº¸ BeanDefinition</span></a></h3>
<p>BeanDefinition å°±æ˜¯ Bean çš„ç”Ÿäº§å›¾çº¸ï¼Œä»–ä»¬ä¼šå­˜å‚¨åœ¨ Spring å®¹å™¨å½“ä¸­ï¼Œå½“æˆ‘ä»¬éœ€è¦çš„æ—¶å€™ï¼Œæˆ–è€…å®¹å™¨éœ€è¦çš„æ—¶å€™ï¼ŒSpring å®¹å™¨å°±ä¼šæ ¹æ®è¿™äº›ç”Ÿäº§å›¾çº¸æ¥ç”Ÿäº§ Bean å®ä¾‹ã€‚å½“ç„¶åœ¨ IOC ç¯‡ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“è¯¥æ€ä¹ˆå®šä¹‰è¿™äº› BeanDefinition çš„å…ƒæ•°æ®ï¼Œå³åŸºäº xml çš„æ–¹å¼æˆ–è€…æ³¨è§£ç­‰æ–¹å¼ã€‚</p>
<figure><img src="@source/backend/ssm/spring/image/image_LZq0A022r_.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<h4 id="å®šä½-beandefinition-å…ƒæ•°æ®ä¿¡æ¯" tabindex="-1"><a class="header-anchor" href="#å®šä½-beandefinition-å…ƒæ•°æ®ä¿¡æ¯"><span>å®šä½ BeanDefinition å…ƒæ•°æ®ä¿¡æ¯</span></a></h4>
<p>æˆ‘ä»¬éƒ½æ¸…æ¥šäº† Spring Bean åœ¨å®¹å™¨ä¸­æœ€å¼€å§‹å°±æ˜¯ BeanDefinitionï¼Œè€Œ BeanDefinition çš„å…ƒæ•°æ®ä¿¡æ¯æ˜¯å¯ä»¥ç”±æˆ‘ä»¬ä»¥ xml çš„æ–¹å¼è¿›è¡Œå®šä¹‰çš„ã€‚</p>
<div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><pre v-pre class="language-xml"><code>    <span class="token comment">&lt;!-- å®šä¹‰ä¸€ä¸ªç®€å•çš„ Bean --></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cn.t.code.vo.User<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>zs<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>order<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>10001<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userId<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è€Œä¸”é€šè¿‡ä»¥ä¸‹ä»£ç å¯ä»¥è½½å…¥æˆ‘ä»¬å®šä¹‰çš„ BeanDefinition å…ƒæ•°æ®ä¿¡æ¯ï¼Œå¹¶é€šè¿‡ getBean è·å–å¯¹åº”çš„ Bean å®ä¾‹ï¼Œé¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥å…ˆæ¢è®¨æ¢è®¨ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¼ å…¥ spring-demo.xml è¿™ä¹ˆä¸€ä¸²å…³äºæˆ‘ä»¬å®šä¹‰çš„ xml çš„åç§°æ–‡æœ¬å°±èƒ½å¸®åŠ©æˆ‘ä»¬å®šä½åˆ°è¯¥ xml å¹¶è¿›è¡ŒåŠ è½½ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre v-pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ClassPathXmlApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"spring-demo.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span>context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬åªéœ€çœ‹ spring-demo.xml äº¤ç»™äº†è°æ¥å¤„ç†å³å¯ï¼Œè€Œä¸”è·Ÿè¿‡å¤§è‡´æµç¨‹çš„æˆ‘ä»¬ï¼Œä¹Ÿä¸éš¾å‘ç°ï¼Œè¿™æ®µ xml æ–‡æœ¬æ˜¯äº¤ç”± ClassPathXmlApplicationContext æ„é€ å‡½æ•°çš„ setConfigLocations(configLocations)æ–¹æ³•å¤„ç†äº†</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre v-pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span>
      <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> configLocations<span class="token punctuation">,</span> <span class="token keyword">boolean</span> refresh<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">ApplicationContext</span> parent<span class="token punctuation">)</span>
      <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>

    <span class="token keyword">super</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//å¤„ç†èµ„æºè·¯å¾„</span>
    <span class="token function">setConfigLocations</span><span class="token punctuation">(</span>configLocations<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>refresh<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é‚£ä¹ˆæ¥ä¸‹æ¥å°±è¦çœ‹çœ‹ setConfigLocations æ–¹æ³•æ˜¯å¦‚ä½•å¤„ç†æˆ‘ä»¬è®¾ç½®çš„ configLocations çš„ï¼ŒresolvePath ä¸»è¦æ˜¯ä¸ºäº†å¤„ç†è·¯å¾„ä¸­çš„å ä½ç¬¦ï¼ˆ${}ï¼‰çš„ï¼Œå½“ç„¶æœ€åä¼šå°†è¿™äº›æˆ‘ä»¬ä¼ å…¥çš„æ–‡ä»¶è·¯å¾„å­˜å‚¨åœ¨ configLocations æ•°ç»„ä¸­ï¼Œç›¸å½“äºé”å®šç›®æ ‡äº†ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre v-pre class="language-java"><code>  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setConfigLocations</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> locations<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>locations <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">noNullElements</span><span class="token punctuation">(</span>locations<span class="token punctuation">,</span> <span class="token string">"Config locations must not be null"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>configLocations <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span>locations<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> locations<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>configLocations<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">resolvePath</span><span class="token punctuation">(</span>locations<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>configLocations <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†æ˜¯é€šè¿‡å‚æ•°ï¼Œä¼šå‘ç°æˆ‘ä»¬å¾€é‡Œä¼ çš„åªæ˜¯&quot;spring-demo.xml&quot;è€Œå·²ï¼Œå®¹å™¨åˆæ˜¯æ€ä¹ˆçŸ¥é“æ˜¯ classpath ä¸‹çš„å‘¢ï¼ŸIOC ç¯‡æˆ‘ä»¬åˆ†æå®¹å™¨åˆå§‹åŒ–æµç¨‹çš„è¿‡ç¨‹ä¸­æ¥è§¦åˆ°äº†ä»¥ä¸‹è¿™å—æ­¥éª¤</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre v-pre class="language-java"><code><span class="token comment">// Tell the subclass to refresh the internal bean factory.</span>
<span class="token class-name">ConfigurableListableBeanFactory</span> beanFactory <span class="token operator">=</span> <span class="token function">obtainFreshBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ªæ­¥éª¤ä¸­ï¼Œæˆ‘ä»¬ä¼šå‘ç°å…¶ä¸­çš„ org.springframework.context.support.AbstractRefreshableApplicationContext#refreshBeanFactory æ–¹æ³•ä¼šæœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„åŠ¨ä½œå°±æ˜¯ loadBeanDefinitions(beanFactory);ï¼Œæ²¡é”™ï¼Œå°±æ˜¯åœ¨è¿™é‡Œ Spring IOC å®¹å™¨è¿›è¡Œ BeanDefinition çš„åŠ è½½ï¼Œæœ‰äº† BeanDefintion è¿™å¼ è®¾è®¡å›¾çº¸ï¼Œåˆ¶é€  Bean é‚£å¯ä¸æ˜¯è½»è€Œæ˜“ä¸¾çš„äº‹æƒ…å—ï¼Ÿ</p>
<p>æ‰€ä»¥æƒ³è¦æ˜ç™½ BeanDefinition æ˜¯æ€ä¹ˆä» XML åŠ è½½åˆ°å®¹å™¨ä¸­çš„ï¼Œè¿™ä¸ªæ–¹æ³•å°±æ˜¯æˆ‘ä»¬è·Ÿè¸ªçš„é‡ç‚¹æ–¹æ³•ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre v-pre class="language-java"><code><span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æ—¢ç„¶æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ xml æ ¼å¼å®šä¹‰ Beanï¼Œé‚£ä¹ˆè°ƒç”¨çš„è‡ªç„¶ä¹Ÿæ˜¯ org.springframework.context.support.AbstractXmlApplicationContext äº†ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒAbstractXmlApplicationContext çš„ç»§æ‰¿å…³ç³»å¦‚ä¸‹ï¼š</p>
<p>AbstractXmlApplicationContext â†’ AbstractRefreshableConfigApplicationContext â†’AbstractRefreshableApplicationContext â†’ AbstractApplicationContext â†’DefaultResourceLoader</p>
<p>æ‰€ä»¥ï¼ŒAbstractXmlApplicationContext æˆ–è€…è¯´ ApplicationContext åŠå…¶æ´¾ç”Ÿå…¶å®ä¹Ÿæ˜¯ä¸€ä¸ªèµ„æºåŠ è½½å™¨ã€‚</p>
<p>å½“æˆ‘ä»¬è·Ÿè¿› AbstractXmlApplicationContext æ—¶ï¼Œå°±ä¼šå‘ç° AbstractXmlApplicationContext æˆä¸ºäº†èµ„æºå¤„ç†å™¨è®¾ç½®è¿›äº† XmlBeanDefinitionReader ä¸­ï¼Œå¹¶ä¸”åœ¨ loadBeanDefinitions ä¸­è¿›è¡Œ BeanDefinition çš„åŠ è½½ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre v-pre class="language-java"><code>  <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span><span class="token class-name">DefaultListableBeanFactory</span> beanFactory<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token comment">// åˆ›å»ºç”¨äºä» Xml ä¸­è¯»å– BeanDefinition çš„è¯»å–å™¨ï¼Œå¹¶é€šè¿‡å›è°ƒè®¾ç½®åˆ° IoC å®¹å™¨ä¸­å»ï¼Œå®¹å™¨ä½¿ç”¨è¯¥è¯»å–å™¨è¯»å– BeanDefinition èµ„æº</span>
    <span class="token class-name">XmlBeanDefinitionReader</span> beanDefinitionReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XmlBeanDefinitionReader</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Configure the bean definition reader with this context's</span>
    <span class="token comment">// resource loading environment.</span>
    beanDefinitionReader<span class="token punctuation">.</span><span class="token function">setEnvironment</span><span class="token punctuation">(</span><span class="token function">getEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    beanDefinitionReader<span class="token punctuation">.</span><span class="token function">setResourceLoader</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// è®¾ç½® SAX è§£æå™¨ï¼ŒSAXï¼ˆsimple API for XMLï¼‰æ˜¯å¦ä¸€ç§ XML è§£ææ–¹æ³•ã€‚ç›¸æ¯”äº DOMï¼ŒSAX é€Ÿåº¦æ›´å¿«ï¼Œå ç”¨å†…å­˜æ›´å°ã€‚</span>
    <span class="token comment">// å®ƒé€è¡Œæ‰«ææ–‡æ¡£ï¼Œä¸€è¾¹æ‰«æä¸€è¾¹è§£æã€‚ç›¸æ¯”äºå…ˆå°†æ•´ä¸ª XML æ–‡ä»¶æ‰«æè¿›å†…å­˜ï¼Œå†è¿›è¡Œè§£æçš„ DOMï¼ŒSAX å¯ä»¥åœ¨è§£ææ–‡æ¡£çš„</span>
    <span class="token comment">// ä»»æ„æ—¶åˆ»åœæ­¢è§£æï¼Œä½†æ“ä½œä¹Ÿæ¯” DOM å¤æ‚ã€‚</span>
    beanDefinitionReader<span class="token punctuation">.</span><span class="token function">setEntityResolver</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ResourceEntityResolver</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">initBeanDefinitionReader</span><span class="token punctuation">(</span>beanDefinitionReader<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//åŸºäºXmlBeanDefinitionReader è¿›è¡ŒBeanDefinitionåŠ è½½</span>
    <span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span>beanDefinitionReader<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è€Œæˆ‘ä»¬ç»§ç»­è·Ÿè¿›è‡³ loadBeanDefinitions æ–¹æ³•æ—¶ï¼ŒgetConfigLocations å¤„ä¼šè¿”å›æˆ‘ä»¬ä¹‹å‰è®¾ç½®çš„ configLocations å¹¶äº¤ç”± XmlBeanDefinitionReader è¿›è¡Œ BeanDefinition åŠ è½½</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre v-pre class="language-java"><code>  <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span><span class="token class-name">XmlBeanDefinitionReader</span> reader<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token comment">//è¿™é‡ŒClassPathXmlApplicationContextå¯¹getConfigResourcesè¿›è¡Œäº†é‡å†™</span>
    <span class="token comment">//ä½¿å¾—æˆ‘ä»¬å¯ä»¥é€šè¿‡ClassPathXmlApplicationContext(String path , Class&lt;?> clazz)</span>
    <span class="token comment">//æ¥æ ¹æ®æŒ‡å®šç±»æ¥åŠ è½½ç±»èµ„æºæ‰€åœ¨çš„xmlèµ„æº</span>
    <span class="token class-name">Resource</span><span class="token punctuation">[</span><span class="token punctuation">]</span> configResources <span class="token operator">=</span> <span class="token function">getConfigResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>configResources <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      reader<span class="token punctuation">.</span><span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span>configResources<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//è¿™é‡Œä¼šè¿”å›çš„å°±æ˜¯ä¹‹å‰åœ¨ClassPathXmlApplicationContextæ„é€ å‡½æ•°ä¸­è·‘çš„setConfigLocation()çš„å€¼</span>
    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> configLocations <span class="token operator">=</span> <span class="token function">getConfigLocations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>configLocations <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//XmlBeanDefinitionReader è°ƒç”¨å…¶çˆ¶ç±» AbstractBeanDefinitionReader çš„æ–¹æ³•ä»é…ç½®ä½ç½®åŠ è½½ BeanDefinition</span>
      reader<span class="token punctuation">.</span><span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span>configLocations<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>


  <span class="token comment">//org.springframework.context.support.AbstractRefreshableConfigApplicationContext#getConfigLocations</span>
  <span class="token keyword">protected</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getConfigLocations</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>configLocations <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>configLocations <span class="token operator">:</span> <span class="token function">getDefaultConfigLocations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¥½äº†è¿™éƒ¨åˆ†å†…å®¹æˆ‘ä»¬éœ€è¦ç»§ç»­å¾€ä¸‹è·Ÿï¼Œç›´è‡³ org.springframework.beans.factory.support.AbstractBeanDefinitionReader#loadBeanDefinitions(java.lang.String, java.util.Set&lt;org.springframework.core.io.Resource&gt;)è¿™ä¸ªæ–¹æ³•ï¼Œå½“ç„¶åœ¨æ­¤ä¹‹å‰è¿˜æœ‰å‡ ä¸ªé‡è½½çš„æ–¹æ³•ï¼Œä½†æ˜¯æˆ‘ä»¬å…ˆåˆ°è¿™é‡Œåœåœè„š ğŸ˜‚ï¼ˆæ¥ä¸‹æ¥è¿˜ä¼šæœ‰ä¸€è¿ä¸²çš„ loadBeanDefinitionsï¼‰ã€‚</p>
<p>AbstractXmlApplicationContext çš„ loadBeanDefinitions ä¸­å°† AbstractXmlApplicationContext,è®¾ä¸ºäº† ResourceLoaderï¼Œæ­¤æ—¶å°±éœ€è¦å°† AbstractXmlApplicationContext ä½œä¸ºèµ„æºåŠ è½½å™¨è·å–å‡ºæ¥ã€‚å…¶ä¸­ AbstractXmlApplicationContext æ˜¯ ResourcePatternResolver ç±»å‹çš„èµ„æºåŠ è½½å™¨ï¼Œè¿™ä¸ªæˆ‘ä»¬å¯ä»¥èµ°å…¥ ResourcePatternResolver çœ‹çœ‹å…¶å®ç°ï¼Œæˆ‘ä»¬ä¼šå‘ç°å‡¡æ˜¯ ResourcePatternResolver ç±»å‹çš„èµ„æºåŠ è½½å…¶éƒ½ä¼šæœ‰ classpath *:çš„å‰ç¼€ï¼Œè¿™ä¹Ÿå°±è§£é‡Šäº†ä¸ºä»€ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡ ClassPathXmlApplication(&quot;spring-test.xml&quot;)ï¼Œå°±èƒ½æ‰¾åˆ°èµ„æºç›®å½•ä¸‹çš„ xml é…ç½®ã€‚</p>
<h5 id="support-abstractbeandefinitionreader-loadbeandefinitions-java-lang-string-java-util-set-org-springframework-core-io-resource" tabindex="-1"><a class="header-anchor" href="#support-abstractbeandefinitionreader-loadbeandefinitions-java-lang-string-java-util-set-org-springframework-core-io-resource"><span>support.AbstractBeanDefinitionReader#loadBeanDefinitions(java.lang.String, java.util.Set&lt;org.springframework.core.io.Resource&gt;)</span></a></h5>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre v-pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span><span class="token class-name">String</span> location<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Resource</span><span class="token punctuation">></span></span> actualResources<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeanDefinitionStoreException</span> <span class="token punctuation">{</span>
    <span class="token comment">//AbstractXmlApplicationContext</span>
    <span class="token class-name">ResourceLoader</span> resourceLoader <span class="token operator">=</span> <span class="token function">getResourceLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>resourceLoader <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BeanDefinitionStoreException</span><span class="token punctuation">(</span>
          <span class="token string">"Cannot load bean definitions from location ["</span> <span class="token operator">+</span> location <span class="token operator">+</span> <span class="token string">"]: no ResourceLoader available"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//å½“æˆ‘ä»¬ç‚¹è¿›ResourcePatternResolverï¼Œä¼šå‘ç°ä»¥ä¸‹è¿™æ®µä»£ç ï¼Œå°±çœŸç›¸å¤§ç™½äº†</span>
    <span class="token comment">//String CLASSPATH_ALL_URL_PREFIX = "classpath*:";</span>
    <span class="token comment">//è€ŒAbstractXmlApplicationContextæ­£æ˜¯ResourcePatternResolverçš„å®ç°</span>
    <span class="token comment">//ResourcePatternResolveråŠ è½½çš„æ­£æ˜¯classpathä¸‹çš„æˆ‘ä»¬å®šä¹‰å¥½çš„èµ„æº</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>resourceLoader <span class="token keyword">instanceof</span> <span class="token class-name">ResourcePatternResolver</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">//åŸºäºResourcePatternResolverè¯»å–å…·ä½“è·¯å¾„ä¸‹çš„èµ„æº</span>
        <span class="token class-name">Resource</span><span class="token punctuation">[</span><span class="token punctuation">]</span> resources <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ResourcePatternResolver</span><span class="token punctuation">)</span> resourceLoader<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResources</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æœ‰äº†èµ„æºï¼Œåé¢å°±å¯ä»¥è¿›è¡Œèµ„æºè§£æäº†</span>
        <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span>resources<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>actualResources <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>actualResources<span class="token punctuation">,</span> resources<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isTraceEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          logger<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">"Loaded "</span> <span class="token operator">+</span> count <span class="token operator">+</span> <span class="token string">" bean definitions from location pattern ["</span> <span class="token operator">+</span> location <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> count<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BeanDefinitionStoreException</span><span class="token punctuation">(</span>
            <span class="token string">"Could not resolve bean definition resource pattern ["</span> <span class="token operator">+</span> location <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// Can only load single resources by absolute URL.</span>
      <span class="token class-name">Resource</span> resource <span class="token operator">=</span> resourceLoader<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>actualResources <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        actualResources<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isTraceEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">"Loaded "</span> <span class="token operator">+</span> count <span class="token operator">+</span> <span class="token string">" bean definitions from location ["</span> <span class="token operator">+</span> location <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> count<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="resourcepatternresolver-å·¥å…·ç±»" tabindex="-1"><a class="header-anchor" href="#resourcepatternresolver-å·¥å…·ç±»"><span>ResourcePatternResolver å·¥å…·ç±»</span></a></h5>
<p>å¦å¤–ï¼Œå…³äº ResourcePatternResolverï¼Œæˆ‘ä»¬æ—¥å¸¸ä¹Ÿå¯ä»¥ç”¨äºæˆ‘ä»¬è¿›è¡Œèµ„æºåŠ è½½ï¼Œè€Œä¸” ResourcePatternResolver æ”¯æŒ Ant é£æ ¼çš„è·¯å¾„ï¼Œæ‰€ä»¥åŠ è½½èµ„æºä¹Ÿæ˜¯éå¸¸æ–¹ä¾¿çš„ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre v-pre class="language-java"><code> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">//PathMatchingResourcePatternResolver æ˜¯ ResourcePatternResolverçš„å®ç°</span>
        <span class="token class-name">PathMatchingResourcePatternResolver</span> resolver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PathMatchingResourcePatternResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// æ”¯æŒä½¿ç”¨Anté£æ ¼çš„è·¯å¾„æ¨¡å¼ï¼ŒåŠ è½½æ‰€æœ‰åŒ¹é…çš„ç±»è·¯å¾„èµ„æº</span>
        <span class="token class-name">Resource</span><span class="token punctuation">[</span><span class="token punctuation">]</span> resources <span class="token operator">=</span> resolver<span class="token punctuation">.</span><span class="token function">getResources</span><span class="token punctuation">(</span><span class="token string">"classpath*:*.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Resource</span> resource <span class="token operator">:</span> resources<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Classpath = "</span> <span class="token operator">+</span> resource<span class="token punctuation">.</span><span class="token function">getFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> description <span class="token operator">=</span> resource<span class="token punctuation">.</span><span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Description = "</span> <span class="token operator">+</span> description<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token class-name">ResourcePatternResolver</span>çš„ä½¿ç”¨
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç›®å‰ä¸ºæ­¢ï¼Œéƒ½æ˜¯ä¸ºäº†æ ¹æ®è·¯å¾„è·å–èµ„æºï¼Œæ¥ä¸‹æ¥çš„ loadBeanDefinitions ä¾¿æ˜¯åŸºäºè·å–çš„èµ„æºè¿›è¡Œèµ„æºåŠ è½½å’¯ï¼</p>
<h4 id="åŠ è½½-beandefinition" tabindex="-1"><a class="header-anchor" href="#åŠ è½½-beandefinition"><span>åŠ è½½ BeanDefinition</span></a></h4>
<h5 id="èµ„æºå‡†å¤‡" tabindex="-1"><a class="header-anchor" href="#èµ„æºå‡†å¤‡"><span>èµ„æºå‡†å¤‡</span></a></h5>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬ä¼šé‡åˆ°å„ç§é‡è½½ä¸è°ƒç”¨çš„ loadBeanDefinitionsï¼Œç›´åˆ°æ¥åˆ° org.springframework.beans.factory.xml.XmlBeanDefinitionReader#loadBeanDefinitions(org.springframework.core.io.support.EncodedResource)è¯¥æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬ä¼šå‘ç°ä¸€ä¸ªæˆ‘ä»¬çœ‹æºç ä¸€å®šä¼šé‡ç‚¹å…³æ³¨çš„æ ¸å¿ƒæ–¹æ³• doxxx å¼€å¤´çš„æ–¹æ³•ï¼Œé‚£å°±æ˜¯ doLoadBeanDefinitions()ï¼Œæˆ‘ä»¬å°†ä¼šåœ¨è¿™ä¸ªæ–¹æ³•å†…æ­å¼€åŠ è½½ BeanDefintion çš„çœŸç›¸ã€‚</p>
<h6 id="xml-xmlbeandefinitionreader-loadbeandefinitions-org-springframework-core-io-support-encodedresource" tabindex="-1"><a class="header-anchor" href="#xml-xmlbeandefinitionreader-loadbeandefinitions-org-springframework-core-io-support-encodedresource"><span>xml.XmlBeanDefinitionReader#loadBeanDefinitions(org.springframework.core.io.support.EncodedResource)</span></a></h6>
<p>åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆçœ‹çœ‹ä»¥ä¸‹æ–¹æ³•åšäº†äº›ä»€ä¹ˆäº‹æƒ…ï¼Œä»¥ä¸‹çš„æ–¹æ³•åšçš„å…¶å®èµ„æºåœ¨è¯»å–åŠ è½½å‰æ‰€éœ€è¦åšçš„äº‹æƒ…ï¼Œç®€å•æ¥è¯´å°±æ˜¯å±‚å±‚åŒ…è£…ï¼Œå…ˆä» Resource â†’ EncodedResource â†’ InputStream â†’ InputSource ï¼Œæœ€åå°† InputSource äº¤ç”± doLoadBeanDefinitions æ¥å¤„ç†</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre v-pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span><span class="token class-name">Resource</span> resource<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeanDefinitionStoreException</span> <span class="token punctuation">{</span>
  <span class="token comment">//å°†è¯»åˆ°èµ„æºåŒ…è£…ä¸ºEncodedResourceç±»ï¼Œé‡Œé¢æ¶µç›–è¯¥èµ„æºçš„ç¼–ç ä¿¡æ¯ï¼Œå­—ç¬¦é›†ç­‰</span>
  <span class="token keyword">return</span> <span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">EncodedResource</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span><span class="token class-name">EncodedResource</span> encodedResource<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeanDefinitionStoreException</span> <span class="token punctuation">{</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">notNull</span><span class="token punctuation">(</span>encodedResource<span class="token punctuation">,</span> <span class="token string">"EncodedResource must not be null"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isTraceEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      logger<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">"Loading XML bean definitions from "</span> <span class="token operator">+</span> encodedResource<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//resourcesCurrentlyBeingLoaded å®é™…ä¸Šæ˜¯ä¸€ä¸ª ThreadLocal&lt;Set&lt;EncodedResource>></span>
    <span class="token comment">//resourcesCurrentlyBeingLoaded ç”¨äºè·Ÿè¸ªå½“å‰çº¿ç¨‹æ­£åœ¨åŠ è½½çš„èµ„æºï¼Œ</span>
    <span class="token comment">//é˜²æ­¢å¾ªç¯åŠ è½½å’Œé‡å¤åŠ è½½èµ„æºã€‚è¿™æ ·å¯ä»¥ç¡®ä¿åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½</span>
    <span class="token comment">//èƒ½å®‰å…¨åœ°åŠ è½½ XML bean å®šä¹‰ï¼Œè€Œä¸ä¼šå¹²æ‰°å…¶ä»–çº¿ç¨‹çš„åŠ è½½è¿‡ç¨‹ã€‚</span>
    <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">EncodedResource</span><span class="token punctuation">></span></span> currentResources <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>resourcesCurrentlyBeingLoaded<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>currentResources<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>encodedResource<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BeanDefinitionStoreException</span><span class="token punctuation">(</span>
          <span class="token string">"Detected cyclic loading of "</span> <span class="token operator">+</span> encodedResource <span class="token operator">+</span> <span class="token string">" - check your import definitions!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> encodedResource<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//è·å–èµ„æºè¾“å…¥æµå¹¶åŒ…è£…æˆInputSource</span>
      <span class="token class-name">InputSource</span> inputSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InputSource</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>encodedResource<span class="token punctuation">.</span><span class="token function">getEncoding</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        inputSource<span class="token punctuation">.</span><span class="token function">setEncoding</span><span class="token punctuation">(</span>encodedResource<span class="token punctuation">.</span><span class="token function">getEncoding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">//å…·ä½“å¤„ç†èµ„æºæµç¨‹</span>
      <span class="token keyword">return</span> <span class="token function">doLoadBeanDefinitions</span><span class="token punctuation">(</span>inputSource<span class="token punctuation">,</span> encodedResource<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BeanDefinitionStoreException</span><span class="token punctuation">(</span>
          <span class="token string">"IOException parsing XML document from "</span> <span class="token operator">+</span> encodedResource<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">finally</span> <span class="token punctuation">{</span>
      currentResources<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>encodedResource<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>currentResources<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>resourcesCurrentlyBeingLoaded<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span>io<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span>EncodedResource</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="æ‰§è¡ŒåŠ è½½-beandefinition" tabindex="-1"><a class="header-anchor" href="#æ‰§è¡ŒåŠ è½½-beandefinition"><span>æ‰§è¡ŒåŠ è½½ BeanDefinition</span></a></h5>
<h6 id="xml-xmlbeandefinitionreader-doloadbeandefinitions" tabindex="-1"><a class="header-anchor" href="#xml-xmlbeandefinitionreader-doloadbeandefinitions"><span>xml.XmlBeanDefinitionReader#doLoadBeanDefinitions</span></a></h6>
<p>æ¥ä¸‹æ¥å°±æ˜¯é‡å¤´æˆ doLoadBeanDefinitions äº†ï¼Œä¸è¿‡ doLoadBeanDefinitions ä¹‹å‰å¯ä»¥å…ˆäº†è§£è¿™å…¶ä¸­çš„é‡è¦è§’è‰² org.springframework.beans.factory.xml.DocumentLoader</p>
<h6 id="documentloader" tabindex="-1"><a class="header-anchor" href="#documentloader"><span>DocumentLoader</span></a></h6>
<p>DocumentLoader æ˜¯ä¸“é—¨ç”¨äºåŠ è½½å’Œè§£æ XML æ–‡æ¡£çš„ï¼Œé€šå¸¸ç”¨äºè§£æ Spring é…ç½®æ–‡ä»¶ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre v-pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">DocumentLoader</span> <span class="token punctuation">{</span>
  <span class="token doc-comment comment">/**
     * ä»æä¾›çš„ InputSource source åŠ è½½ä¸€ä¸ª Document documentã€‚
     * <span class="token keyword">@param</span> <span class="token parameter">inputSource</span> è¦åŠ è½½çš„æ–‡æ¡£çš„æ¥æº
     * <span class="token keyword">@param</span> <span class="token parameter">entityResolver</span> ç”¨äºè§£æä»»ä½•å®ä½“çš„è§£æå™¨
     * <span class="token keyword">@param</span> <span class="token parameter">errorHandler</span> ç”¨äºåœ¨åŠ è½½æ–‡æ¡£è¿‡ç¨‹ä¸­æŠ¥å‘Šä»»ä½•é”™è¯¯
     * <span class="token keyword">@param</span> <span class="token parameter">validationMode</span> éªŒè¯çš„ç±»å‹
     * ï¼ˆorg.springframework.util.xml.XmlValidationModeDetector#VALIDATION_DTD DTD
     * æˆ– org.springframework.util.xml.XmlValidationModeDetector#VALIDATION_XSD XSD)
     * <span class="token keyword">@param</span> <span class="token parameter">namespaceAware</span> å¦‚æœéœ€è¦æä¾›å¯¹XMLå‘½åç©ºé—´çš„æ”¯æŒï¼Œåˆ™ä¸º true
     * <span class="token keyword">@return</span> åŠ è½½çš„ Document document
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">Exception</span></span> å¦‚æœå‘ç”Ÿé”™è¯¯
     */</span>
  <span class="token class-name">Document</span> <span class="token function">loadDocument</span><span class="token punctuation">(</span>
      <span class="token class-name">InputSource</span> inputSource<span class="token punctuation">,</span> <span class="token class-name">EntityResolver</span> entityResolver<span class="token punctuation">,</span>
      <span class="token class-name">ErrorHandler</span> errorHandler<span class="token punctuation">,</span> <span class="token keyword">int</span> validationMode<span class="token punctuation">,</span> <span class="token keyword">boolean</span> namespaceAware<span class="token punctuation">)</span>
      <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="defaultdocumentloader-çš„ä½¿ç”¨æ¡ˆä¾‹" tabindex="-1"><a class="header-anchor" href="#defaultdocumentloader-çš„ä½¿ç”¨æ¡ˆä¾‹"><span>DefaultDocumentLoader çš„ä½¿ç”¨æ¡ˆä¾‹</span></a></h6>
<p>åœ¨ Spring ä¸­çš„ DocumentLoader é€šå¸¸æ˜¯ä½¿ç”¨äºå¯¹èµ„æºè¿›è¡Œè§£æå’ŒåŠ è½½çš„ï¼Œä¸å¦¨æˆ‘ä»¬å¯ä»¥çœ‹çœ‹ä»¥ä¸‹ä½¿ç”¨ DocumentLoader çš„ç¤ºä¾‹ä»£ç ï¼ŒSpring ä½¿ç”¨çš„æ˜¯ DefaultDocumentLoader å®ç°æ¥è¿›è¡Œèµ„æºçš„åŠ è½½ï¼Œå½“æˆ‘ä»¬å¾—åˆ°äº† Document å¯¹è±¡ä»¥åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ç³»åˆ—çš„ Document æä¾›çš„ API å¯¹æ„å»ºå‡ºæ¥çš„ Document å¯¹è±¡è¿›è¡Œè§£ææ‰“å°ï¼Œæ ¹æ®æ‰§è¡Œç»“æœæ¥çœ‹ï¼ŒXML èµ„æºå·²ç»å˜æˆäº†ä¸€ç§ç»“æ„åŒ–ï¼ˆå…·å¤‡é”®å€¼å…³ç³»ï¼‰çš„æ•°æ®äº†ï¼Œæ„å‘³ç€æˆ‘ä»¬æƒ³è¦å–åˆ°å…¶ä¸­çš„ä¿¡æ¯å…¶å®æ˜¯å¾ˆç®€å•çš„äº†ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre v-pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// åˆ›å»ºè¦åŠ è½½çš„èµ„æºå¯¹è±¡</span>
            <span class="token class-name">Resource</span> resource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathResource</span><span class="token punctuation">(</span><span class="token string">"bean-config.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// åˆ›å»º DocumentLoader å®ä¾‹</span>
            <span class="token class-name">DefaultDocumentLoader</span> documentLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultDocumentLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// åŠ è½½å’Œè§£æ XML æ–‡æ¡£</span>
            <span class="token class-name">Document</span> document <span class="token operator">=</span> documentLoader<span class="token punctuation">.</span><span class="token function">loadDocument</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputSource</span><span class="token punctuation">(</span>resource<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// æ‰“å° XML æ–‡æ¡£çš„å†…å®¹</span>
            <span class="token function">printDetailedDocumentInfo</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * æ‰“å°è¯¦ç»†çš„XMLæ–‡æ¡£ä¿¡æ¯ï¼ŒåŒ…æ‹¬å…ƒç´ ã€å±æ€§å’Œæ–‡æœ¬å†…å®¹ã€‚
     *
     * <span class="token keyword">@param</span> <span class="token parameter">document</span> è¦æ‰“å°çš„XMLæ–‡æ¡£å¯¹è±¡
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">printDetailedDocumentInfo</span><span class="token punctuation">(</span><span class="token class-name">Document</span> document<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Element</span> rootElement <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getDocumentElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printElementInfo</span><span class="token punctuation">(</span>rootElement<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * é€’å½’æ‰“å°XMLå…ƒç´ çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬å…ƒç´ åç§°ã€å±æ€§å’Œå­èŠ‚ç‚¹ã€‚
     *
     * <span class="token keyword">@param</span> <span class="token parameter">element</span> è¦æ‰“å°çš„XMLå…ƒç´ 
     * <span class="token keyword">@param</span> <span class="token parameter">indent</span>  å½“å‰æ‰“å°çš„ç¼©è¿›
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">printElementInfo</span><span class="token punctuation">(</span><span class="token class-name">Element</span> element<span class="token punctuation">,</span> <span class="token class-name">String</span> indent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// æ‰“å°å…ƒç´ åç§°</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>indent <span class="token operator">+</span> <span class="token string">"Element: "</span> <span class="token operator">+</span> element<span class="token punctuation">.</span><span class="token function">getNodeName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// æ‰“å°å…ƒç´ çš„å±æ€§</span>
        <span class="token class-name">NamedNodeMap</span> attributes <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token function">getAttributes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> attributes<span class="token punctuation">.</span><span class="token function">getLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Node</span> attribute <span class="token operator">=</span> attributes<span class="token punctuation">.</span><span class="token function">item</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>indent <span class="token operator">+</span> <span class="token string">"  Attribute: "</span> <span class="token operator">+</span> attribute<span class="token punctuation">.</span><span class="token function">getNodeName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" = "</span> <span class="token operator">+</span> attribute<span class="token punctuation">.</span><span class="token function">getNodeValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// æ‰“å°å…ƒç´ çš„å­èŠ‚ç‚¹ï¼ˆå¯èƒ½æ˜¯å…ƒç´ æˆ–æ–‡æœ¬ï¼‰</span>
        <span class="token class-name">NodeList</span> childNodes <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token function">getChildNodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> childNodes<span class="token punctuation">.</span><span class="token function">getLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Node</span> childNode <span class="token operator">=</span> childNodes<span class="token punctuation">.</span><span class="token function">item</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>childNode<span class="token punctuation">.</span><span class="token function">getNodeType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">Node</span><span class="token punctuation">.</span><span class="token constant">ELEMENT_NODE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// å¦‚æœå­èŠ‚ç‚¹æ˜¯å…ƒç´ ï¼Œé€’å½’æ‰“å°å®ƒ</span>
                <span class="token function">printElementInfo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Element</span><span class="token punctuation">)</span> childNode<span class="token punctuation">,</span> indent <span class="token operator">+</span> <span class="token string">"  "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>childNode<span class="token punctuation">.</span><span class="token function">getNodeType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">Node</span><span class="token punctuation">.</span><span class="token constant">TEXT_NODE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// å¦‚æœå­èŠ‚ç‚¹æ˜¯æ–‡æœ¬ï¼Œæ‰“å°æ–‡æœ¬å†…å®¹</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>indent <span class="token operator">+</span> <span class="token string">"  Text: "</span> <span class="token operator">+</span> childNode<span class="token punctuation">.</span><span class="token function">getNodeValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment">//æ‰§è¡Œç»“æœå¦‚ä¸‹</span>
        <span class="token class-name">Element</span><span class="token operator">:</span> beans
      <span class="token class-name">Attribute</span><span class="token operator">:</span> xmlns <span class="token operator">=</span> http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>org<span class="token operator">/</span>schema<span class="token operator">/</span>beans
      <span class="token class-name">Attribute</span><span class="token operator">:</span> xmlns<span class="token operator">:</span>xsi <span class="token operator">=</span> http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>w3<span class="token punctuation">.</span>org<span class="token operator">/</span><span class="token number">2001</span><span class="token operator">/</span><span class="token class-name">XMLSchema</span><span class="token operator">-</span>instance
      <span class="token class-name">Attribute</span><span class="token operator">:</span> xsi<span class="token operator">:</span>schemaLocation <span class="token operator">=</span> http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>org<span class="token operator">/</span>schema<span class="token operator">/</span>beans                            http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>org<span class="token operator">/</span>schema<span class="token operator">/</span>beans<span class="token operator">/</span>spring<span class="token operator">-</span>beans<span class="token punctuation">.</span>xsd
      <span class="token class-name">Text</span><span class="token operator">:</span>
      <span class="token class-name">Text</span><span class="token operator">:</span>
      <span class="token class-name">Element</span><span class="token operator">:</span> bean
        <span class="token class-name">Attribute</span><span class="token operator">:</span> <span class="token keyword">class</span> <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span>User</span>
        <span class="token class-name">Attribute</span><span class="token operator">:</span> id <span class="token operator">=</span> user
        <span class="token class-name">Text</span><span class="token operator">:</span>
        <span class="token class-name">Element</span><span class="token operator">:</span> property
          <span class="token class-name">Attribute</span><span class="token operator">:</span> name <span class="token operator">=</span> name
          <span class="token class-name">Attribute</span><span class="token operator">:</span> value <span class="token operator">=</span> <span class="token class-name">T</span>
        <span class="token class-name">Text</span><span class="token operator">:</span>
        <span class="token class-name">Element</span><span class="token operator">:</span> property
          <span class="token class-name">Attribute</span><span class="token operator">:</span> name <span class="token operator">=</span> age
          <span class="token class-name">Attribute</span><span class="token operator">:</span> value <span class="token operator">=</span> <span class="token number">26</span>
        <span class="token class-name">Text</span><span class="token operator">:</span>
      <span class="token class-name">Text</span><span class="token operator">:</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="xmlbeandefinitionreader-doloadbeandefinitions" tabindex="-1"><a class="header-anchor" href="#xmlbeandefinitionreader-doloadbeandefinitions"><span>XmlBeanDefinitionReader#doLoadBeanDefinitions()</span></a></h6>
<p>Spring å¤„ç† xml èµ„æºæ–‡ä»¶é¦–å…ˆä¼šé€šè¿‡ doLoadDocument æ–¹æ³•æ¥åŸºäºè¾“å…¥èµ„æºè§£æä¸º org.w3c.dom.Document å¯¹è±¡</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre v-pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">int</span> <span class="token function">doLoadBeanDefinitions</span><span class="token punctuation">(</span><span class="token class-name">InputSource</span> inputSource<span class="token punctuation">,</span> <span class="token class-name">Resource</span> resource<span class="token punctuation">)</span>
      <span class="token keyword">throws</span> <span class="token class-name">BeanDefinitionStoreException</span> <span class="token punctuation">{</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token comment">//åŸºäºDocumentLoaderå¯¹InputSourceï¼ˆXMLèµ„æºï¼‰è¿›è¡Œè§£æå¹¶è¿”å›Document å¯¹è±¡</span>
      <span class="token comment">//XMLèµ„æºç»è¿‡è§£æä¼šè¢«è§£æä¸ºæ ‘çš„å½¢å¼ï¼Œæ‰€ä»¥åŸºäºDocumentæä¾›çš„æ¥å£å¯ä»¥ä¾¿äºæˆ‘ä»¬æ“ä½œ</span>
      <span class="token comment">//XMLè§£æå‡ºæ¥çš„ä¿¡æ¯</span>
      <span class="token class-name">Document</span> doc <span class="token operator">=</span> <span class="token function">doLoadDocument</span><span class="token punctuation">(</span>inputSource<span class="token punctuation">,</span> resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token function">registerBeanDefinitions</span><span class="token punctuation">(</span>doc<span class="token punctuation">,</span> resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isDebugEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"Loaded "</span> <span class="token operator">+</span> count <span class="token operator">+</span> <span class="token string">" bean definitions from "</span> <span class="token operator">+</span> resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> count<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">BeanDefinitionStoreException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> ex<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SAXParseException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">XmlBeanDefinitionStoreException</span><span class="token punctuation">(</span>resource<span class="token punctuation">.</span><span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token string">"Line "</span> <span class="token operator">+</span> ex<span class="token punctuation">.</span><span class="token function">getLineNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" in XML document from "</span> <span class="token operator">+</span> resource <span class="token operator">+</span> <span class="token string">" is invalid"</span><span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SAXException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">XmlBeanDefinitionStoreException</span><span class="token punctuation">(</span>resource<span class="token punctuation">.</span><span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token string">"XML document from "</span> <span class="token operator">+</span> resource <span class="token operator">+</span> <span class="token string">" is invalid"</span><span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ParserConfigurationException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BeanDefinitionStoreException</span><span class="token punctuation">(</span>resource<span class="token punctuation">.</span><span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token string">"Parser configuration exception parsing XML from "</span> <span class="token operator">+</span> resource<span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BeanDefinitionStoreException</span><span class="token punctuation">(</span>resource<span class="token punctuation">.</span><span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token string">"IOException parsing XML document from "</span> <span class="token operator">+</span> resource<span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BeanDefinitionStoreException</span><span class="token punctuation">(</span>resource<span class="token punctuation">.</span><span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token string">"Unexpected exception parsing XML document from "</span> <span class="token operator">+</span> resource<span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>


<span class="token keyword">protected</span> <span class="token class-name">Document</span> <span class="token function">doLoadDocument</span><span class="token punctuation">(</span><span class="token class-name">InputSource</span> inputSource<span class="token punctuation">,</span> <span class="token class-name">Resource</span> resource<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>documentLoader<span class="token punctuation">.</span><span class="token function">loadDocument</span><span class="token punctuation">(</span>inputSource<span class="token punctuation">,</span> <span class="token function">getEntityResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>errorHandler<span class="token punctuation">,</span>
        <span class="token function">getValidationModeForResource</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">isNamespaceAware</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="è§£æ-beandefinition" tabindex="-1"><a class="header-anchor" href="#è§£æ-beandefinition"><span>è§£æ BeanDefinition</span></a></h5>
<h6 id="xmlbeandefinitionreader-registerbeandefinitions" tabindex="-1"><a class="header-anchor" href="#xmlbeandefinitionreader-registerbeandefinitions"><span>XmlBeanDefinitionReader#registerBeanDefinitions()</span></a></h6>
<p>registerBeanDefinitions æ–¹æ³•å¯ä»¥çœ‹åˆ°è§£æå‡ºæ¥çš„ Document ä¼šè¢«åå°„åˆ›å»ºå‡ºæ¥çš„ Document è§£æå™¨ - BeanDefinitionDocumentReader è¿›è¡Œè¯»å–ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre v-pre class="language-java"><code>  <span class="token keyword">protected</span> <span class="token class-name">BeanDefinitionDocumentReader</span> <span class="token function">createBeanDefinitionDocumentReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">instantiateClass</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>documentReaderClass<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">registerBeanDefinitions</span><span class="token punctuation">(</span><span class="token class-name">Document</span> doc<span class="token punctuation">,</span> <span class="token class-name">Resource</span> resource<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeanDefinitionStoreException</span> <span class="token punctuation">{</span>
    <span class="token comment">//åŸºäºåå°„åˆ›å»ºBeanDefinitionDocumentReader</span>
    <span class="token class-name">BeanDefinitionDocumentReader</span> documentReader <span class="token operator">=</span> <span class="token function">createBeanDefinitionDocumentReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//ä¸ºäº†è®¡ç®—å‡ºæ­¤æ—¶BeanDefintionçš„æ³¨å†Œæ•°é‡ï¼Œéœ€è¦å…ˆè®¡ç®—ç›®å‰å·²æ³¨å†Œçš„BeanDefinitionæ•°é‡</span>
    <span class="token keyword">int</span> countBefore <span class="token operator">=</span> <span class="token function">getRegistry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBeanDefinitionCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//æ‰§è¡Œè§£æBeanDefinitionçš„å…¥å£</span>
    documentReader<span class="token punctuation">.</span><span class="token function">registerBeanDefinitions</span><span class="token punctuation">(</span>doc<span class="token punctuation">,</span> <span class="token function">createReaderContext</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">getRegistry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBeanDefinitionCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> countBefore<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="spring-æä¾›çš„åå°„å·¥å…·ç±»-beanutils-instantiateclass" tabindex="-1"><a class="header-anchor" href="#spring-æä¾›çš„åå°„å·¥å…·ç±»-beanutils-instantiateclass"><span>Spring æä¾›çš„åå°„å·¥å…·ç±» BeanUtils.instantiateClass</span></a></h6>
<p>å…¶ä¸­ BeanUtils.instantiateClass ä¹Ÿæ˜¯ Spring æä¾›ç”¨äºåå°„çš„å·¥å…·ç±»ï¼Œä½¿ç”¨èµ·æ¥ä¹Ÿæ˜¯éå¸¸æ–¹ä¾¿çš„ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre v-pre class="language-java"><code> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">NoSuchMethodException</span> <span class="token punctuation">{</span>
        <span class="token comment">//ä½¿ç”¨Spring åå°„å·¥å…·ç±» , åŸºäºæ— å‚æ„é€ è¿›è¡Œå®ä¾‹åŒ–</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">instantiateClass</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//ä½¿ç”¨Spring åå°„å·¥å…·ç±» , åŸºäºæœ‰å‚æ„é€ è¿›è¡Œå®ä¾‹åŒ–</span>
        <span class="token class-name">Constructor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">></span></span> constructor <span class="token operator">=</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getConstructor</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> user1 <span class="token operator">=</span> <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">instantiateClass</span><span class="token punctuation">(</span>constructor <span class="token punctuation">,</span> <span class="token string">"T"</span> <span class="token punctuation">,</span> <span class="token number">18L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user1<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span></span>BeanUtils</span>çš„ä½¿ç”¨
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="defaultbeandefinitiondocumentreader-doregisterbeandefinitions" tabindex="-1"><a class="header-anchor" href="#defaultbeandefinitiondocumentreader-doregisterbeandefinitions"><span>DefaultBeanDefinitionDocumentReader#doRegisterBeanDefinitions</span></a></h6>
<p>å½“æˆ‘ä»¬ç»§ç»­å¾€ä¸‹è·Ÿè¸ªï¼Œä¼šè·Ÿè¸ªåˆ° DefaultBeanDefinitionDocumentReader ä¸‹çš„ doRegisterBeanDefinitions æ–¹æ³•ï¼Œä¸è¿‡åœ¨åˆ†æè¯¥æ–¹æ³•ä¹‹å‰ï¼Œå¯ä»¥å…ˆè®¤è¯†è®¤è¯† DefaultBeanDefinitionDocumentReader ç±»ï¼Œæ˜ å…¥çœ¼å¸˜çš„æ˜¯ä¸€å †ç†Ÿæ‚‰çš„å¸¸é‡ï¼Œå…¶å®ä»ä»¥ä¸‹å¸¸é‡æˆ‘ä»¬ä¾¿èƒ½å¤§æ¦‚åœ°çŒœå‡ºè¯¥ç±»çš„èŒè´£ä¹‹ä¸€å°±æ˜¯å¤„ç†æˆ‘ä»¬åœ¨ xml ä¸­å®šä¹‰çš„ä»¥ä¸‹é…ç½®ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre v-pre class="language-java"><code>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">BEAN_ELEMENT</span> <span class="token operator">=</span> <span class="token class-name">BeanDefinitionParserDelegate</span><span class="token punctuation">.</span><span class="token constant">BEAN_ELEMENT</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">NESTED_BEANS_ELEMENT</span> <span class="token operator">=</span> <span class="token string">"beans"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">ALIAS_ELEMENT</span> <span class="token operator">=</span> <span class="token string">"alias"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">NAME_ATTRIBUTE</span> <span class="token operator">=</span> <span class="token string">"name"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">ALIAS_ATTRIBUTE</span> <span class="token operator">=</span> <span class="token string">"alias"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">IMPORT_ELEMENT</span> <span class="token operator">=</span> <span class="token string">"import"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">RESOURCE_ATTRIBUTE</span> <span class="token operator">=</span> <span class="token string">"resource"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">PROFILE_ATTRIBUTE</span> <span class="token operator">=</span> <span class="token string">"profile"</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>çŸ¥é“äº†è¯¥ç±»çš„å…·ä½“åŠŸèƒ½ï¼Œç„¶åæˆ‘ä»¬å†çœ‹çœ‹ doRegisterBeanDefinitions æ–¹æ³•åšäº†ä»€ä¹ˆï¼Œé€šè¿‡è§‚å¯Ÿè¯¥æ–¹æ³•ï¼Œå¯ä»¥å‘ç°è¯¥æ–¹æ³•å±äºä¸€ä¸ªæ¨¡æ¿æ–¹æ³•ï¼Œè¿™å°±æ„å‘³ç€ï¼Œè¯¥æ–¹æ³•å¯ä»¥çœ‹åˆ° RegisterBeanDefinitions çš„ä¸€æ•´ä¸ªè¦åšçš„æµç¨‹ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre v-pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doRegisterBeanDefinitions</span><span class="token punctuation">(</span><span class="token class-name">Element</span> root<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">//BeanDefinitionParserDelegate  è§£æbeanä¸­å„é¡¹é…ç½®çš„æ ¸å¿ƒå¤„ç†å™¨</span>
    <span class="token class-name">BeanDefinitionParserDelegate</span> parent <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>delegate<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>delegate <span class="token operator">=</span> <span class="token function">createDelegate</span><span class="token punctuation">(</span><span class="token function">getReaderContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> root<span class="token punctuation">,</span> parent<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>delegate<span class="token punctuation">.</span><span class="token function">isDefaultNamespace</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token class-name">String</span> profileSpec <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token constant">PROFILE_ATTRIBUTE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasText</span><span class="token punctuation">(</span>profileSpec<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> specifiedProfiles <span class="token operator">=</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">tokenizeToStringArray</span><span class="token punctuation">(</span>
            profileSpec<span class="token punctuation">,</span> <span class="token class-name">BeanDefinitionParserDelegate</span><span class="token punctuation">.</span><span class="token constant">MULTI_VALUE_ATTRIBUTE_DELIMITERS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">getReaderContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">acceptsProfiles</span><span class="token punctuation">(</span>specifiedProfiles<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isDebugEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"Skipped XML bean definition file due to specified profiles ["</span> <span class="token operator">+</span> profileSpec <span class="token operator">+</span>
                <span class="token string">"] not matching: "</span> <span class="token operator">+</span> <span class="token function">getReaderContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//è§£æçš„å‰ç½®å¤„ç†ï¼Œå¯ä»¥è®©æˆ‘ä»¬å¹²é¢„å¹¶å¢å¼ºSpringå¯¹XMLçš„è§£æ</span>
    <span class="token function">preProcessXml</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//çœŸæ­£æ‰§è¡ŒDocumentçš„è§£æ</span>
    <span class="token function">parseBeanDefinitions</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>delegate<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//è§£æçš„åç½®æ“ä½œï¼Œå¯ä»¥ä»¤æˆ‘ä»¬å¹²é¢„å¹¶å¢å¼ºbeanå®Œæˆè§£æåçš„æ“ä½œ</span>
    <span class="token function">postProcessXml</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>delegate <span class="token operator">=</span> parent<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="beandefinitionparserdelegate" tabindex="-1"><a class="header-anchor" href="#beandefinitionparserdelegate"><span>BeanDefinitionParserDelegate</span></a></h6>
<p>BeanDefinitionParserDelegate æ˜¯è§£æå¹¶æ³¨å†Œ BeanDefinitions çš„æ ¸å¿ƒç»„ä»¶ï¼Œæ‰€ä»¥å¾ˆæœ‰å¿…è¦è®¤è¯†è®¤è¯†è¿™ä½å·¥åŒ ï¼Œå½“ç„¶ä»å®šä¹‰çš„å¸¸é‡æ¥çœ‹ï¼Œä¾¿èƒ½å¤Ÿå¾—çŸ¥ä»–å…·å¤‡çš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€ï¼Œä¾¿æ˜¯å°† XML é…ç½®æ–‡ä»¶ä¸­çš„ &lt;bean&gt;ã€&lt;property&gt; ç­‰å…ƒç´ è§£æä¸ºå¯¹åº”çš„ BeanDefinition å¯¹è±¡æ‰€éœ€çš„å…ƒæ•°æ®ã€‚å®šä¹‰çš„è¿™éƒ¨åˆ†å¸¸é‡éƒ½æ˜¯æˆ‘ä»¬ä»¥ xml å½¢å¼å®šä¹‰ bean æ—¶ç”¨åˆ°çš„å±æ€§æˆ–è€…å€¼ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre v-pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">BEANS_NAMESPACE_URI</span> <span class="token operator">=</span> <span class="token string">"http://www.springframework.org/schema/beans"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">MULTI_VALUE_ATTRIBUTE_DELIMITERS</span> <span class="token operator">=</span> <span class="token string">",; "</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">TRUE_VALUE</span> <span class="token operator">=</span> <span class="token string">"true"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">FALSE_VALUE</span> <span class="token operator">=</span> <span class="token string">"false"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">DEFAULT_VALUE</span> <span class="token operator">=</span> <span class="token string">"default"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">DESCRIPTION_ELEMENT</span> <span class="token operator">=</span> <span class="token string">"description"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">AUTOWIRE_NO_VALUE</span> <span class="token operator">=</span> <span class="token string">"no"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">AUTOWIRE_BY_NAME_VALUE</span> <span class="token operator">=</span> <span class="token string">"byName"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">AUTOWIRE_BY_TYPE_VALUE</span> <span class="token operator">=</span> <span class="token string">"byType"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">AUTOWIRE_CONSTRUCTOR_VALUE</span> <span class="token operator">=</span> <span class="token string">"constructor"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">AUTOWIRE_AUTODETECT_VALUE</span> <span class="token operator">=</span> <span class="token string">"autodetect"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">NAME_ATTRIBUTE</span> <span class="token operator">=</span> <span class="token string">"name"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">BEAN_ELEMENT</span> <span class="token operator">=</span> <span class="token string">"bean"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">META_ELEMENT</span> <span class="token operator">=</span> <span class="token string">"meta"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">ID_ATTRIBUTE</span> <span class="token operator">=</span> <span class="token string">"id"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">PARENT_ATTRIBUTE</span> <span class="token operator">=</span> <span class="token string">"parent"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">CLASS_ATTRIBUTE</span> <span class="token operator">=</span> <span class="token string">"class"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">ABSTRACT_ATTRIBUTE</span> <span class="token operator">=</span> <span class="token string">"abstract"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">SCOPE_ATTRIBUTE</span> <span class="token operator">=</span> <span class="token string">"scope"</span><span class="token punctuation">;</span>

  <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">SINGLETON_ATTRIBUTE</span> <span class="token operator">=</span> <span class="token string">"singleton"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">LAZY_INIT_ATTRIBUTE</span> <span class="token operator">=</span> <span class="token string">"lazy-init"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">AUTOWIRE_ATTRIBUTE</span> <span class="token operator">=</span> <span class="token string">"autowire"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">AUTOWIRE_CANDIDATE_ATTRIBUTE</span> <span class="token operator">=</span> <span class="token string">"autowire-candidate"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">PRIMARY_ATTRIBUTE</span> <span class="token operator">=</span> <span class="token string">"primary"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">DEPENDS_ON_ATTRIBUTE</span> <span class="token operator">=</span> <span class="token string">"depends-on"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">INIT_METHOD_ATTRIBUTE</span> <span class="token operator">=</span> <span class="token string">"init-method"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">DESTROY_METHOD_ATTRIBUTE</span> <span class="token operator">=</span> <span class="token string">"destroy-method"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">FACTORY_METHOD_ATTRIBUTE</span> <span class="token operator">=</span> <span class="token string">"factory-method"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">FACTORY_BEAN_ATTRIBUTE</span> <span class="token operator">=</span> <span class="token string">"factory-bean"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">CONSTRUCTOR_ARG_ELEMENT</span> <span class="token operator">=</span> <span class="token string">"constructor-arg"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">INDEX_ATTRIBUTE</span> <span class="token operator">=</span> <span class="token string">"index"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">TYPE_ATTRIBUTE</span> <span class="token operator">=</span> <span class="token string">"type"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">VALUE_TYPE_ATTRIBUTE</span> <span class="token operator">=</span> <span class="token string">"value-type"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">KEY_TYPE_ATTRIBUTE</span> <span class="token operator">=</span> <span class="token string">"key-type"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">PROPERTY_ELEMENT</span> <span class="token operator">=</span> <span class="token string">"property"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">REF_ATTRIBUTE</span> <span class="token operator">=</span> <span class="token string">"ref"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">VALUE_ATTRIBUTE</span> <span class="token operator">=</span> <span class="token string">"value"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">LOOKUP_METHOD_ELEMENT</span> <span class="token operator">=</span> <span class="token string">"lookup-method"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">REPLACED_METHOD_ELEMENT</span> <span class="token operator">=</span> <span class="token string">"replaced-method"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">REPLACER_ATTRIBUTE</span> <span class="token operator">=</span> <span class="token string">"replacer"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">ARG_TYPE_ELEMENT</span> <span class="token operator">=</span> <span class="token string">"arg-type"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">ARG_TYPE_MATCH_ATTRIBUTE</span> <span class="token operator">=</span> <span class="token string">"match"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">REF_ELEMENT</span> <span class="token operator">=</span> <span class="token string">"ref"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">IDREF_ELEMENT</span> <span class="token operator">=</span> <span class="token string">"idref"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">BEAN_REF_ATTRIBUTE</span> <span class="token operator">=</span> <span class="token string">"bean"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">PARENT_REF_ATTRIBUTE</span> <span class="token operator">=</span> <span class="token string">"parent"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">VALUE_ELEMENT</span> <span class="token operator">=</span> <span class="token string">"value"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">NULL_ELEMENT</span> <span class="token operator">=</span> <span class="token string">"null"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">ARRAY_ELEMENT</span> <span class="token operator">=</span> <span class="token string">"array"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">LIST_ELEMENT</span> <span class="token operator">=</span> <span class="token string">"list"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">SET_ELEMENT</span> <span class="token operator">=</span> <span class="token string">"set"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">MAP_ELEMENT</span> <span class="token operator">=</span> <span class="token string">"map"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">ENTRY_ELEMENT</span> <span class="token operator">=</span> <span class="token string">"entry"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">KEY_ELEMENT</span> <span class="token operator">=</span> <span class="token string">"key"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">KEY_ATTRIBUTE</span> <span class="token operator">=</span> <span class="token string">"key"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">KEY_REF_ATTRIBUTE</span> <span class="token operator">=</span> <span class="token string">"key-ref"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">VALUE_REF_ATTRIBUTE</span> <span class="token operator">=</span> <span class="token string">"value-ref"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">PROPS_ELEMENT</span> <span class="token operator">=</span> <span class="token string">"props"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">PROP_ELEMENT</span> <span class="token operator">=</span> <span class="token string">"prop"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">MERGE_ATTRIBUTE</span> <span class="token operator">=</span> <span class="token string">"merge"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">QUALIFIER_ELEMENT</span> <span class="token operator">=</span> <span class="token string">"qualifier"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">QUALIFIER_ATTRIBUTE_ELEMENT</span> <span class="token operator">=</span> <span class="token string">"attribute"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">DEFAULT_LAZY_INIT_ATTRIBUTE</span> <span class="token operator">=</span> <span class="token string">"default-lazy-init"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">DEFAULT_MERGE_ATTRIBUTE</span> <span class="token operator">=</span> <span class="token string">"default-merge"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">DEFAULT_AUTOWIRE_ATTRIBUTE</span> <span class="token operator">=</span> <span class="token string">"default-autowire"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">DEFAULT_AUTOWIRE_CANDIDATES_ATTRIBUTE</span> <span class="token operator">=</span> <span class="token string">"default-autowire-candidates"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">DEFAULT_INIT_METHOD_ATTRIBUTE</span> <span class="token operator">=</span> <span class="token string">"default-init-method"</span><span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">DEFAULT_DESTROY_METHOD_ATTRIBUTE</span> <span class="token operator">=</span> <span class="token string">"default-destroy-method"</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“æˆ‘ä»¬å°†ç›®å…‰è½¬ç§»åˆ°è¯¥ç±»çš„è¿™ä¸¤ä¸ªæ–¹æ³•æ—¶ï¼Œèƒ½å¤Ÿæ›´åŠ æ˜ç¡®åœ°å¾—çŸ¥è¯¥ç±»çš„åŠŸèƒ½æ— ç–‘å°±æ˜¯è¿›è¡Œ Element çš„è§£æï¼Œå¹¶æœ€åç”Ÿæˆ BeanDefinitionHolderã€‚</p>
<h6 id="xml-beandefinitionparserdelegate-parsebeandefinitionelement-org-w3c-dom-element-org-springframework-beans-factory-config-beandefinition" tabindex="-1"><a class="header-anchor" href="#xml-beandefinitionparserdelegate-parsebeandefinitionelement-org-w3c-dom-element-org-springframework-beans-factory-config-beandefinition"><span>xml.BeanDefinitionParserDelegate#parseBeanDefinitionElement(org.w3c.dom.Element, org.springframework.beans.factory.config.BeanDefinition)</span></a></h6>
<p>ä½†æ˜¯ä¸ºä»€ä¹ˆä¼šè¿”å› BeanDefinitionHolder è€Œä¸æ˜¯ BeanDefinition å‘¢ï¼Ÿè§‚å¯Ÿ BeanDefinitionHolder å¯ä»¥å‘ç°å…¶å® BeanDefinitionHolder æ˜¯ BeanDefinition çš„å·¥å…·ç±»ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬é€šè¿‡ beanName å’Œ aliases æ‰¾åˆ°å¯¹åº”çš„ BeanDefinition ï¼Œå¦å¤–å°±æ˜¯ BeanDefinitionHolder å°† beanName å’Œ aliases è¿™ç§å”¯ä¸€æ ‡è¯†å’Œå…·ä½“çš„ BeanDefinition åˆ†ç¦»å¼€æ¥äº†ï¼Œå±äºæ˜¯ BeanDefinition çš„èƒ½åŠ›å¢å¼ºã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre v-pre class="language-java"><code>  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BeanDefinitionHolder</span> <span class="token keyword">implements</span> <span class="token class-name">BeanMetadataElement</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">BeanDefinition</span> beanDefinition<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> beanName<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Nullable</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> aliases<span class="token punctuation">;</span>

    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Nullable</span>
  <span class="token keyword">public</span> <span class="token class-name">BeanDefinitionHolder</span> <span class="token function">parseBeanDefinitionElement</span><span class="token punctuation">(</span><span class="token class-name">Element</span> ele<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">parseBeanDefinitionElement</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Nullable</span>
  <span class="token keyword">public</span> <span class="token class-name">BeanDefinitionHolder</span> <span class="token function">parseBeanDefinitionElement</span><span class="token punctuation">(</span><span class="token class-name">Element</span> ele<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">BeanDefinition</span> containingBean<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ---------å¯¹bean name çš„å¤„ç†  -------------</span>
    <span class="token class-name">String</span> id <span class="token operator">=</span> ele<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token constant">ID_ATTRIBUTE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> nameAttr <span class="token operator">=</span> ele<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token constant">NAME_ATTRIBUTE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> aliases <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasLength</span><span class="token punctuation">(</span>nameAttr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//å–bean çš„åˆ«åï¼Œæ‰€ä»¥æˆ‘ä»¬å®šä¹‰å¤šä¸ªbeançš„åˆ«åæ—¶å¯ä»¥ä»¥,æˆ–è€…;åˆ†å‰²</span>
      <span class="token comment">// &lt;bean id="user" class="com.example.model.User" name="mainUser,oldUser"></span>
      <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> nameArr <span class="token operator">=</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">tokenizeToStringArray</span><span class="token punctuation">(</span>nameAttr<span class="token punctuation">,</span> <span class="token constant">MULTI_VALUE_ATTRIBUTE_DELIMITERS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      aliases<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>nameArr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">String</span> beanName <span class="token operator">=</span> id<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasText</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>aliases<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      beanName <span class="token operator">=</span> aliases<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isTraceEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">"No XML 'id' specified - using '"</span> <span class="token operator">+</span> beanName <span class="token operator">+</span>
            <span class="token string">"' as bean name and "</span> <span class="token operator">+</span> aliases <span class="token operator">+</span> <span class="token string">" as aliases"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>containingBean <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//æ ¡éªŒbean name</span>
      <span class="token function">checkNameUniqueness</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> aliases<span class="token punctuation">,</span> ele<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ---------å¯¹bean name çš„å¤„ç†  -------------</span>
    <span class="token comment">// å°†xmlä¸­å„ä¸ªå…ƒç´ è§£æä¸ºBeanDefinitionå…³é”®æ–¹æ³•</span>
    <span class="token class-name">AbstractBeanDefinition</span> beanDefinition <span class="token operator">=</span> <span class="token function">parseBeanDefinitionElement</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> beanName<span class="token punctuation">,</span> containingBean<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ---------å¯¹æ²¡æœ‰ä¸»åŠ¨é…ç½®bean name çš„å¤„ç†  -------------</span>
    <span class="token comment">// ç»“æœæ˜¯ä¼šå–è¯¥ç±»çš„å…¨é™å®šç±»å</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>beanDefinition <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasText</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>containingBean <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            beanName <span class="token operator">=</span> <span class="token class-name">BeanDefinitionReaderUtils</span><span class="token punctuation">.</span><span class="token function">generateBeanName</span><span class="token punctuation">(</span>
                beanDefinition<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>readerContext<span class="token punctuation">.</span><span class="token function">getRegistry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">//å…·ä½“çš„ç”Ÿæˆbean name çš„è§„åˆ™å¯å‚è€ƒï¼ˆéæ³¨è§£å½¢å¼ï¼‰</span>
            <span class="token comment">//org.springframework.beans.factory.support.BeanDefinitionReaderUtils#generateBeanName(org.springframework.beans.factory.config.BeanDefinition, org.springframework.beans.factory.support.BeanDefinitionRegistry, boolean)</span>
            <span class="token comment">//æœ‰ä»¥ä¸‹å‘½åæƒ…æ™¯</span>
            <span class="token comment">//1.å†…éƒ¨beanï¼Œåˆ™åœ¨å…¶åç§°åé™„åŠ ä¸€ä¸ªåŸºäºå¯¹è±¡èº«ä»½çš„å“ˆå¸Œå€¼ï¼Œå¹¶è¿”å›ã€‚</span>
            <span class="token comment">//2.åˆ™è°ƒç”¨uniqueBeanNameæ–¹æ³•ï¼Œç¡®ä¿åç§°åœ¨beanå·¥å‚ä¸­å”¯ä¸€ï¼Œå¹¶è¿”å›</span>
            <span class="token comment">//3.ä¸å­˜åœ¨ç±»åä½†å­˜åœ¨çˆ¶beanåç§°ï¼Œåˆ™ä½¿ç”¨çˆ¶beanåç§°åŠ $childä½œä¸ºåˆå§‹beanåç§°ã€‚</span>
            <span class="token comment">//4.æ—¢æ²¡æœ‰ç±»åä¹Ÿæ²¡æœ‰çˆ¶beanåç§°ä½†æœ‰å·¥å‚beanåç§°ï¼Œåˆ™ä½¿ç”¨å·¥å‚beanåç§°åŠ $createdä½œä¸ºåˆå§‹beanåç§°ã€‚</span>
            beanName <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>readerContext<span class="token punctuation">.</span><span class="token function">generateBeanName</span><span class="token punctuation">(</span>beanDefinition<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> beanClassName <span class="token operator">=</span> beanDefinition<span class="token punctuation">.</span><span class="token function">getBeanClassName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>beanClassName <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span>
                beanName<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>beanClassName<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> beanName<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> beanClassName<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
                <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>readerContext<span class="token punctuation">.</span><span class="token function">getRegistry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isBeanNameInUse</span><span class="token punctuation">(</span>beanClassName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              aliases<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>beanClassName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isTraceEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">"Neither XML 'id' nor 'name' specified - "</span> <span class="token operator">+</span>
                <span class="token string">"using generated bean name ["</span> <span class="token operator">+</span> beanName <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">error</span><span class="token punctuation">(</span>ex<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ele<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// ---------å¯¹æ²¡æœ‰ä¸»åŠ¨é…ç½®bean name çš„å¤„ç†  -------------</span>
      <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> aliasesArray <span class="token operator">=</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">toStringArray</span><span class="token punctuation">(</span>aliases<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BeanDefinitionHolder</span><span class="token punctuation">(</span>beanDefinition<span class="token punctuation">,</span> beanName<span class="token punctuation">,</span> aliasesArray<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="defaultbeandefinitiondocumentreader-parsebeandefinitions" tabindex="-1"><a class="header-anchor" href="#defaultbeandefinitiondocumentreader-parsebeandefinitions"><span>DefaultBeanDefinitionDocumentReader#parseBeanDefinitions</span></a></h6>
<p>å¥½äº†ï¼Œå¯¹ BeanDefinitionParserDelegate æˆ‘ä»¬å·²ç»æœ‰ä¸å°‘çš„äº†è§£äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥ç»§ç»­å›å½’åˆ° doRegisterBeanDefinitions ç»§ç»­è·Ÿè¿›è‡³ parseBeanDefinitions è¿™ä¸ªé‡è¦çš„æ–¹æ³•ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre v-pre class="language-java"><code>  <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doRegisterBeanDefinitions</span><span class="token punctuation">(</span><span class="token class-name">Element</span> root<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token function">parseBeanDefinitions</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>delegate<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>delegate <span class="token operator">=</span> parent<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é¦–å…ˆ parseBeanDefinition ä¼šå…ˆæ ¡éªŒæœ€é¡¶å±‚çš„ beans å…ƒç´ ï¼Œå› ä¸ºæˆ‘ä»¬çš„ xml éƒ½æ˜¯ä»¥ beans å¼€å§‹çš„å˜›ï¼Œä¸»è¦æ ¡éªŒçš„æ˜¯å…³äº beans ä¸­é…ç½®çš„å‘½åç©ºé—´ï¼ŒåŸºäºå‘½åç©ºé—´æ¥åˆ¤æ–­ä½¿ç”¨ Spring æä¾›çš„è§£æè§„åˆ™è¿›è¡Œè§£æè¿˜æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„è§£æè§„åˆ™è¿›è¡Œè§£æï¼ˆå½“ç„¶æå¤§å¤šæ•°éƒ½æ˜¯è·‘çš„ Spring æä¾›çš„è§£æè§„åˆ™ï¼‰ï¼Œæ¥ä¸‹æ¥æ ¡éªŒæ²¡é—®é¢˜äº†ï¼Œä¾¿å¼€å§‹è¿›è¡Œè¿›è¡Œ beans ä¸‹çš„å„ä¸ª Element è¿›è¡Œè§£æäº†ï¼Œä¸»è¦é›†ä¸­åœ¨ parseDefaultElement æ–¹æ³•ä¸­ï¼Œè€Œè¿™å…¶ä¸­æˆ‘ä»¬ä¼šå‘ç°ä¸ç®¡æ˜¯æ ¡éªŒè¿˜æ˜¯è§£æè·Ÿ Element ç›¸å…³çš„ä¸œè¥¿éƒ½æ˜¯äº¤ç”± BeanDefinitionParserDelegate æ¥å®Œæˆçš„ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre v-pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">parseBeanDefinitions</span><span class="token punctuation">(</span><span class="token class-name">Element</span> root<span class="token punctuation">,</span> <span class="token class-name">BeanDefinitionParserDelegate</span> delegate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//å…ˆå¯¹æ ¹èŠ‚ç‚¹è¿›è¡Œæ ¡éªŒï¼Œå…¶å®å°±æ˜¯å¯¹æœ€é¡¶å±‚çš„beanså¯¹åº”çš„å‘½åç©ºé—´è¿›è¡Œæ ¡éªŒ</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>delegate<span class="token punctuation">.</span><span class="token function">isDefaultNamespace</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token class-name">NodeList</span> nl <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token function">getChildNodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nl<span class="token punctuation">.</span><span class="token function">getLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Node</span> node <span class="token operator">=</span> nl<span class="token punctuation">.</span><span class="token function">item</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>node <span class="token keyword">instanceof</span> <span class="token class-name">Element</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token class-name">Element</span> ele <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Element</span><span class="token punctuation">)</span> node<span class="token punctuation">;</span>
          <span class="token comment">// å¦‚æœ ele å®šä¹‰çš„ Document çš„å…ƒç´ èŠ‚ç‚¹ä½¿ç”¨çš„æ˜¯ Spring é»˜è®¤çš„ XML å‘½åç©ºé—´</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>delegate<span class="token punctuation">.</span><span class="token function">isDefaultNamespace</span><span class="token punctuation">(</span>ele<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">parseDefaultElement</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> delegate<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// è‹¥æ²¡æœ‰ä½¿ç”¨ Spring é»˜è®¤çš„ XML å‘½åç©ºé—´ï¼Œåˆ™ä½¿ç”¨ç”¨æˆ·è‡ªå®šä¹‰çš„è§£æè§„åˆ™è§£æå…ƒç´ èŠ‚ç‚¹</span>
            delegate<span class="token punctuation">.</span><span class="token function">parseCustomElement</span><span class="token punctuation">(</span>ele<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
      delegate<span class="token punctuation">.</span><span class="token function">parseCustomElement</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¥ä¸‹æ¥å°±å¯ä»¥ä¸€èµ·çœ‹çœ‹ parseDefaultElement æ–¹æ³•æ˜¯å¦‚ä½•å¯¹ Elememt çš„å…ƒç´ è¿›è¡Œæ“ä½œçš„ï¼Œå…¶å®è¯»åˆ°è¿™é‡Œï¼Œæ¯ä¸ªæ–¹æ³•åéƒ½å·²ç»èƒ½å¤Ÿå¾ˆæ˜æ˜¾åœ°å‘Šè¯‰æˆ‘ä»¬ä»–æ˜¯åšçš„ä»€ä¹ˆäº‹äº†ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre v-pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">parseDefaultElement</span><span class="token punctuation">(</span><span class="token class-name">Element</span> ele<span class="token punctuation">,</span> <span class="token class-name">BeanDefinitionParserDelegate</span> delegate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// è§£æ &lt;Import> å…ƒç´ </span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>delegate<span class="token punctuation">.</span><span class="token function">nodeNameEquals</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> <span class="token constant">IMPORT_ELEMENT</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">importBeanDefinitionResource</span><span class="token punctuation">(</span>ele<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// è§£æ &lt;Alias> å…ƒç´ </span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>delegate<span class="token punctuation">.</span><span class="token function">nodeNameEquals</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> <span class="token constant">ALIAS_ELEMENT</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">processAliasRegistration</span><span class="token punctuation">(</span>ele<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// æŒ‰ç…§ Spring çš„ beanè§£æè§„åˆ™ è§£æå…ƒç´ </span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>delegate<span class="token punctuation">.</span><span class="token function">nodeNameEquals</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> <span class="token constant">BEAN_ELEMENT</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">processBeanDefinition</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> delegate<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// å¦‚æœè¢«è§£æçš„å…ƒç´ æ˜¯ beansï¼Œåˆ™é€’å½’è°ƒç”¨ doRegisterBeanDefinitions(Element root) æ–¹æ³•è¿›è¡Œè§£æ</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>delegate<span class="token punctuation">.</span><span class="token function">nodeNameEquals</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> <span class="token constant">NESTED_BEANS_ELEMENT</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// recurse</span>
      <span class="token function">doRegisterBeanDefinitions</span><span class="token punctuation">(</span>ele<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¥½äº†ï¼Œå¤šçš„ä¸è¯´ï¼Œç´§æ¥ç€å°±å¯¹ç€å„ä¸ªæ–¹æ³•å±•å¼€çŒ›çƒˆè¿›æ”»</p>
<ul>
<li>
<p>importBeanDefinitionResource è§£æ&lt;Import&gt;å…ƒç´ </p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre v-pre class="language-java"><code><span class="token comment">//å¯¼å…¥é…ç½®ç¤ºä¾‹  ->  &lt;import resource="bean-config2.xml"/></span>

<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">importBeanDefinitionResource</span><span class="token punctuation">(</span><span class="token class-name">Element</span> ele<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//è¯»å–resourceä¿¡æ¯</span>
    <span class="token class-name">String</span> location <span class="token operator">=</span> ele<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token constant">RESOURCE_ATTRIBUTE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasText</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">getReaderContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"Resource location must not be empty"</span><span class="token punctuation">,</span> ele<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Resolve system properties: e.g. "${user.dir}"</span>
    location <span class="token operator">=</span> <span class="token function">getReaderContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">resolveRequiredPlaceholders</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Resource</span><span class="token punctuation">></span></span> actualResources <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Discover whether the location is an absolute or relative URI</span>
    <span class="token keyword">boolean</span> absoluteLocation <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      absoluteLocation <span class="token operator">=</span> <span class="token class-name">ResourcePatternUtils</span><span class="token punctuation">.</span><span class="token function">isUrl</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token class-name">ResourceUtils</span><span class="token punctuation">.</span><span class="token function">toURI</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isAbsolute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">URISyntaxException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// cannot convert to an URI, considering the location relative</span>
      <span class="token comment">// unless it is the well-known Spring prefix "classpath*:"</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Absolute or relative?</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>absoluteLocation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">//ç»§ç»­ä½¿ç”¨ä»¥å¾€ä½¿ç”¨çš„XmlReaderContextè¿›è¡ŒBeanDefinitionåŠ è½½ï¼Œæµç¨‹è·Ÿä»¥ä¸Šçš„å…¶å®æ˜¯ä¸€æ ·çš„</span>
        <span class="token keyword">int</span> importCount <span class="token operator">=</span> <span class="token function">getReaderContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span>location<span class="token punctuation">,</span> actualResources<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isTraceEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          logger<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">"Imported "</span> <span class="token operator">+</span> importCount <span class="token operator">+</span> <span class="token string">" bean definitions from URL location ["</span> <span class="token operator">+</span> location <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">BeanDefinitionStoreException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">getReaderContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>
            <span class="token string">"Failed to import bean definitions from URL location ["</span> <span class="token operator">+</span> location <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">,</span> ele<span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// No URL -> considering resource location as relative to the current file.</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> importCount<span class="token punctuation">;</span>
        <span class="token class-name">Resource</span> relativeResource <span class="token operator">=</span> <span class="token function">getReaderContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createRelative</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>relativeResource<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          importCount <span class="token operator">=</span> <span class="token function">getReaderContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span>relativeResource<span class="token punctuation">)</span><span class="token punctuation">;</span>
          actualResources<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>relativeResource<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token class-name">String</span> baseLocation <span class="token operator">=</span> <span class="token function">getReaderContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          importCount <span class="token operator">=</span> <span class="token function">getReaderContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span>
              <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">applyRelativePath</span><span class="token punctuation">(</span>baseLocation<span class="token punctuation">,</span> location<span class="token punctuation">)</span><span class="token punctuation">,</span> actualResources<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isTraceEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          logger<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">"Imported "</span> <span class="token operator">+</span> importCount <span class="token operator">+</span> <span class="token string">" bean definitions from relative location ["</span> <span class="token operator">+</span> location <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">getReaderContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"Failed to resolve current resource location"</span><span class="token punctuation">,</span> ele<span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">BeanDefinitionStoreException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">getReaderContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>
            <span class="token string">"Failed to import bean definitions from relative location ["</span> <span class="token operator">+</span> location <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">,</span> ele<span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Resource</span><span class="token punctuation">[</span><span class="token punctuation">]</span> actResArray <span class="token operator">=</span> actualResources<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Resource</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">getReaderContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fireImportProcessed</span><span class="token punctuation">(</span>location<span class="token punctuation">,</span> actResArray<span class="token punctuation">,</span> <span class="token function">extractSource</span><span class="token punctuation">(</span>ele<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li>
<li>
<p>processAliasRegistration è§£æ&lt;alias&gt;å…ƒç´ </p>
<p>çœ‹çœ‹ alias æ ‡ç­¾çš„ä½¿ç”¨æ¡ˆä¾‹ï¼Œä¸éš¾çŒœå‡ºï¼Œå…¶ä¸­çš„æ­¥éª¤å…¶å®å°±æ˜¯æ ¹æ® name åˆ°å®¹å™¨ä¸­è·å–å¯¹åº”çš„ Beanï¼Œç„¶åå°†åˆ«åæ³¨å†Œåˆ°è¯¥ Bean çš„ BeanDefinitionHolder ä¸­</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre v-pre class="language-java"><code><span class="token comment">//alias æ ‡ç­¾ä½¿ç”¨ &lt;alias name="userT" alias="T"/></span>

<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">processAliasRegistration</span><span class="token punctuation">(</span><span class="token class-name">Element</span> ele<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> name <span class="token operator">=</span> ele<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token constant">NAME_ATTRIBUTE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> alias <span class="token operator">=</span> ele<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token constant">ALIAS_ATTRIBUTE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> valid <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasText</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">getReaderContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"Name must not be empty"</span><span class="token punctuation">,</span> ele<span class="token punctuation">)</span><span class="token punctuation">;</span>
      valid <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasText</span><span class="token punctuation">(</span>alias<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">getReaderContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"Alias must not be empty"</span><span class="token punctuation">,</span> ele<span class="token punctuation">)</span><span class="token punctuation">;</span>
      valid <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>valid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>

        <span class="token comment">//å°†åˆ«åæ³¨å†Œè‡³è¯¥Beanä¸­</span>
        <span class="token function">getReaderContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRegistry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">registerAlias</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> alias<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">getReaderContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"Failed to register alias '"</span> <span class="token operator">+</span> alias <span class="token operator">+</span>
            <span class="token string">"' for bean with name '"</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">"'"</span><span class="token punctuation">,</span> ele<span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">//å‘å®¹å™¨å‘é€åˆ«åå¤„ç†å®Œæˆäº‹ä»¶</span>
      <span class="token function">getReaderContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fireAliasRegistered</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> alias<span class="token punctuation">,</span> <span class="token function">extractSource</span><span class="token punctuation">(</span>ele<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li>
<li>
<p>processBeanDefinition è§£æ&lt;bean&gt;å…ƒç´ </p>
<p>è¿™ä¸ªæ–¹æ³•æ˜¯éå¸¸é‡è¦çš„ï¼ŒåŸå› åœ¨äºï¼Œè¿™é‡Œä¸ä»…æ˜¯å¯¹ Element çš„è§£æï¼Œä¹Ÿæ˜¯å°† BeanDefinition æ³¨å†Œè‡³ IOC å®¹å™¨çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†ä¸º 3 æ­¥æ¥è¿›è¡Œåˆ†æ</p>
<ol>
<li>
<p>delegate.parseBeanDefinitionElement</p>
<p>å¯¹ä¼ å…¥çš„ Element è¿›è¡Œè§£æå°è£…æˆ BeanDefinitionHolder ï¼Œå½“ç„¶åšè¿™ä»¶äº‹æƒ…çš„ä»ç„¶æ˜¯ BeanDefinitionParserDelegate ï¼Œè¿™ä¸ªåœ¨å‰é¢æ˜¯æœ‰ä»‹ç»çš„ã€‚</p>
</li>
<li>
<p>delegate.decorateBeanDefinitionIfRequired</p>
<p>å¯¹ bdHolder è¿›è¡ŒåŒ…è£…å¤„ç†</p>
</li>
<li>
<p>BeanDefinitionReaderUtils.registerBeanDefinition</p>
<p>ä¸€ç›®äº†ç„¶ï¼Œè¯¥æ–¹æ³•çš„æ„æ€å°±æ˜¯å‘å®¹å™¨æ³¨å†Œ BeanDefinitionï¼Œæ˜¯ä¸€ä¸ªéå¸¸æ ¸å¿ƒçš„è¿‡ç¨‹</p>
</li>
</ol>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre v-pre class="language-java"><code>
  <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">processBeanDefinition</span><span class="token punctuation">(</span><span class="token class-name">Element</span> ele<span class="token punctuation">,</span> <span class="token class-name">BeanDefinitionParserDelegate</span> delegate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//è§£æå°è£…Element æˆBeanDefinitionHolder</span>
    <span class="token class-name">BeanDefinitionHolder</span> bdHolder <span class="token operator">=</span> delegate<span class="token punctuation">.</span><span class="token function">parseBeanDefinitionElement</span><span class="token punctuation">(</span>ele<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>bdHolder <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//è¿›ä¸€æ­¥å°è£…</span>
      bdHolder <span class="token operator">=</span> delegate<span class="token punctuation">.</span><span class="token function">decorateBeanDefinitionIfRequired</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> bdHolder<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">// å‘å®¹å™¨æ³¨å†ŒBeanDefinitionï¼ˆæ ¸å¿ƒï¼‰</span>
        <span class="token class-name">BeanDefinitionReaderUtils</span><span class="token punctuation">.</span><span class="token function">registerBeanDefinition</span><span class="token punctuation">(</span>bdHolder<span class="token punctuation">,</span> <span class="token function">getReaderContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRegistry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">BeanDefinitionStoreException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">getReaderContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"Failed to register bean definition with name '"</span> <span class="token operator">+</span>
            bdHolder<span class="token punctuation">.</span><span class="token function">getBeanName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"'"</span><span class="token punctuation">,</span> ele<span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// å‘å®¹å™¨å‘é€æ³¨å†Œå®Œæ¯•çš„äº‹ä»¶</span>
      <span class="token function">getReaderContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fireComponentRegistered</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BeanComponentDefinition</span><span class="token punctuation">(</span>bdHolder<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol>
<li>
<p>é¦–å…ˆå¯ä»¥å…ˆæ¥çœ‹çœ‹ Element åˆ° BeanDefinition çš„è¿‡ç¨‹ï¼Œæ ¹æ®ä»¥å¾€çš„ç»éªŒï¼Œæˆ‘ä»¬éƒ½æ¸…æ¥šè§£æ Element çš„äº‹æƒ…ä¸»è¦æ˜¯ç”± BeanDefinitionParserDelegate åšçš„ï¼Œæ‰€ä»¥å¯ä»¥å…³æ³¨ BeanDefinitionParserDelegate#parseBeanDefinitionElement(org.w3c.dom.Element, org.springframework.beans.factory.config.BeanDefinition)è¿™ä¸ªæ–¹æ³•</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre v-pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">BeanDefinitionHolder</span> <span class="token function">parseBeanDefinitionElement</span><span class="token punctuation">(</span><span class="token class-name">Element</span> ele<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">BeanDefinition</span> containingBean<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> id <span class="token operator">=</span> ele<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token constant">ID_ATTRIBUTE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> nameAttr <span class="token operator">=</span> ele<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token constant">NAME_ATTRIBUTE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> aliases <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasLength</span><span class="token punctuation">(</span>nameAttr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> nameArr <span class="token operator">=</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">tokenizeToStringArray</span><span class="token punctuation">(</span>nameAttr<span class="token punctuation">,</span> <span class="token constant">MULTI_VALUE_ATTRIBUTE_DELIMITERS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      aliases<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>nameArr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">String</span> beanName <span class="token operator">=</span> id<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasText</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>aliases<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      beanName <span class="token operator">=</span> aliases<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isTraceEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">"No XML 'id' specified - using '"</span> <span class="token operator">+</span> beanName <span class="token operator">+</span>
            <span class="token string">"' as bean name and "</span> <span class="token operator">+</span> aliases <span class="token operator">+</span> <span class="token string">" as aliases"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>containingBean <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">checkNameUniqueness</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> aliases<span class="token punctuation">,</span> ele<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">AbstractBeanDefinition</span> beanDefinition <span class="token operator">=</span> <span class="token function">parseBeanDefinitionElement</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> beanName<span class="token punctuation">,</span> containingBean<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>beanDefinition <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasText</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>containingBean <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            beanName <span class="token operator">=</span> <span class="token class-name">BeanDefinitionReaderUtils</span><span class="token punctuation">.</span><span class="token function">generateBeanName</span><span class="token punctuation">(</span>
                beanDefinition<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>readerContext<span class="token punctuation">.</span><span class="token function">getRegistry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">else</span> <span class="token punctuation">{</span>
            beanName <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>readerContext<span class="token punctuation">.</span><span class="token function">generateBeanName</span><span class="token punctuation">(</span>beanDefinition<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// Register an alias for the plain bean class name, if still possible,</span>
            <span class="token comment">// if the generator returned the class name plus a suffix.</span>
            <span class="token comment">// This is expected for Spring 1.2/2.0 backwards compatibility.</span>
            <span class="token class-name">String</span> beanClassName <span class="token operator">=</span> beanDefinition<span class="token punctuation">.</span><span class="token function">getBeanClassName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>beanClassName <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span>
                beanName<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>beanClassName<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> beanName<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> beanClassName<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
                <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>readerContext<span class="token punctuation">.</span><span class="token function">getRegistry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isBeanNameInUse</span><span class="token punctuation">(</span>beanClassName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              aliases<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>beanClassName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isTraceEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">"Neither XML 'id' nor 'name' specified - "</span> <span class="token operator">+</span>
                <span class="token string">"using generated bean name ["</span> <span class="token operator">+</span> beanName <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">error</span><span class="token punctuation">(</span>ex<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ele<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> aliasesArray <span class="token operator">=</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">toStringArray</span><span class="token punctuation">(</span>aliases<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BeanDefinitionHolder</span><span class="token punctuation">(</span>beanDefinition<span class="token punctuation">,</span> beanName<span class="token punctuation">,</span> aliasesArray<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“ç„¶è½¬ä¸º BeanDefinition çš„è¿™ä¸ªè¿‡ç¨‹å¹¶æ²¡æœ‰é‚£ä¹ˆå¤æ‚ï¼Œåªæ˜¯ä¸€ä¸ªä¸æ–­ä» Element ä¸­å–ä¿¡æ¯ï¼Œset è‡³ BeanDefinition çš„è¿‡ç¨‹ç½¢äº†ï¼Œå‚è€ƒ BeanDefinitionParserDelegate#parseBeanDefinitionElement(org.w3c.dom.Element, java.lang.String, org.springframework.beans.factory.config.BeanDefinition)æ–¹æ³•å³å¯ã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre v-pre class="language-java"><code>  <span class="token annotation punctuation">@Nullable</span>
  <span class="token keyword">public</span> <span class="token class-name">AbstractBeanDefinition</span> <span class="token function">parseBeanDefinitionElement</span><span class="token punctuation">(</span>
      <span class="token class-name">Element</span> ele<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">BeanDefinition</span> containingBean<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//è®°å½•è§£æè¿‡çš„bean</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>parseState<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BeanEntry</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">String</span> className <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token comment">//å¤„ç†classå±æ€§</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ele<span class="token punctuation">.</span><span class="token function">hasAttribute</span><span class="token punctuation">(</span><span class="token constant">CLASS_ATTRIBUTE</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      className <span class="token operator">=</span> ele<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token constant">CLASS_ATTRIBUTE</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//å¤„ç†parentå±æ€§</span>
    <span class="token class-name">String</span> parent <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ele<span class="token punctuation">.</span><span class="token function">hasAttribute</span><span class="token punctuation">(</span><span class="token constant">PARENT_ATTRIBUTE</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      parent <span class="token operator">=</span> ele<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token constant">PARENT_ATTRIBUTE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token comment">// æ ¹æ® &lt;bean> å…ƒç´ é…ç½®çš„ class åç§°å’Œ parent å±æ€§å€¼åˆ›å»º BeanDefinition</span>
      <span class="token class-name">AbstractBeanDefinition</span> bd <span class="token operator">=</span> <span class="token function">createBeanDefinition</span><span class="token punctuation">(</span>className<span class="token punctuation">,</span> parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//å¯¹é…ç½®beançš„å±æ€§è¿›è¡Œè§£æï¼Œå½“ç„¶idå’Œclasså’Œparentåœ¨ä¸Šé¢éƒ½å¤„ç†äº†</span>
      <span class="token comment">//&lt;bean id="userT" class="com.example.model.User"</span>
      <span class="token comment">// ä¸»è¦è§£æè¿™éƒ¨åˆ†å†…å®¹ init-method=""  lazy-init=""  scope="" ...  >&lt;/bean></span>
      <span class="token function">parseBeanDefinitionAttributes</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> beanName<span class="token punctuation">,</span> containingBean<span class="token punctuation">,</span> bd<span class="token punctuation">)</span><span class="token punctuation">;</span>
      bd<span class="token punctuation">.</span><span class="token function">setDescription</span><span class="token punctuation">(</span><span class="token class-name">DomUtils</span><span class="token punctuation">.</span><span class="token function">getChildElementValueByTagName</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> <span class="token constant">DESCRIPTION_ELEMENT</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// è§£æ &lt;bean> å…ƒç´ ä¸­çš„ meta æ ‡ç­¾</span>
      <span class="token comment">//    &lt;bean id="userT" class="com.example.model.User"  ></span>
      <span class="token comment">//  &lt;meta key="author" value="T"/></span>
      <span class="token comment">//  &lt;meta key="version" value="1.0"/></span>
      <span class="token comment">//  meta èµ·åˆ°äº†å¯¹beanä¿¡æ¯çš„æè¿°</span>
      <span class="token function">parseMetaElements</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> bd<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//è§£ælookupæ ‡ç­¾</span>
      <span class="token comment">//å¯ä»¥é€šè¿‡look-upæ ‡ç­¾å»å½±å“beançš„ç”Ÿæˆ</span>
      <span class="token comment">// &lt;!-- å®šä¹‰ä¸€ä¸ªåä¸º userService çš„ Bean --></span>
      <span class="token comment">//  &lt;bean id="userService" class="com.example.service.UserService"></span>
      <span class="token comment">//  &lt;lookup method="getUser" bean="user"/></span>
      <span class="token comment">//&lt;/bean></span>
      <span class="token function">parseLookupOverrideSubElements</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> bd<span class="token punctuation">.</span><span class="token function">getMethodOverrides</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//å¤„ç†replaced-methodæ ‡ç­¾ï¼Œreplaced-method æ ‡ç­¾å¯ä»¥ç”¨äºè¿è¡Œæ—¶æ›¿æ¢Beançš„å†…éƒ¨æ–¹æ³•ï¼Œå½“ç„¶æ„é€ æ–¹æ³•é™¤å¤–</span>
      <span class="token function">parseReplacedMethodSubElements</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> bd<span class="token punctuation">.</span><span class="token function">getMethodOverrides</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//å¤„ç†constructor-argæ ‡ç­¾</span>
      <span class="token function">parseConstructorArgElements</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> bd<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//å¤„ç†propertyæ ‡ç­¾</span>
      <span class="token function">parsePropertyElements</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> bd<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//å¤„ç†qualifieræ ‡ç­¾</span>
      <span class="token function">parseQualifierElements</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> bd<span class="token punctuation">)</span><span class="token punctuation">;</span>

      bd<span class="token punctuation">.</span><span class="token function">setResource</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>readerContext<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      bd<span class="token punctuation">.</span><span class="token function">setSource</span><span class="token punctuation">(</span><span class="token function">extractSource</span><span class="token punctuation">(</span>ele<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">return</span> bd<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"Bean class ["</span> <span class="token operator">+</span> className <span class="token operator">+</span> <span class="token string">"] not found"</span><span class="token punctuation">,</span> ele<span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NoClassDefFoundError</span> err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"Class that bean class ["</span> <span class="token operator">+</span> className <span class="token operator">+</span> <span class="token string">"] depends on not found"</span><span class="token punctuation">,</span> ele<span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"Unexpected failure during bean definition parsing"</span><span class="token punctuation">,</span> ele<span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">finally</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>parseState<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li>
</ol>
</li>
</ul>
<h4 id="beandefinition-æ³¨å†Œè‡³-ioc-å®¹å™¨" tabindex="-1"><a class="header-anchor" href="#beandefinition-æ³¨å†Œè‡³-ioc-å®¹å™¨"><span>BeanDefinition æ³¨å†Œè‡³ IOC å®¹å™¨</span></a></h4>
<p>BeanDefinition æ­¤æ—¶æ­¤åˆ»å·²ç»ç®—æ˜¯ç”Ÿæˆå‡ºæ¥äº†ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±æ˜¯å°†å…¶æ³¨å†Œè¿› IOC å®¹å™¨å½“ä¸­ï¼Œéšæ—¶ç”¨æ¥ç”Ÿæˆ Beanï¼Œå…ˆå›è¿‡å¤´æ¥çœ‹ DefaultBeanDefinitionDocumentReader#processBeanDefinition æ–¹æ³•ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„æµç¨‹</p>
<h6 id="beandefinitionreaderutils-registerbeandefinition" tabindex="-1"><a class="header-anchor" href="#beandefinitionreaderutils-registerbeandefinition"><span>BeanDefinitionReaderUtils#registerBeanDefinition</span></a></h6>
<p>BeanDefinitionReaderUtils.registerBeanDefinition(bdHolder, getReaderContext().getRegistry());è¯¥æ–¹æ³•å°±æ˜¯å°†å®Œæˆè§£æçš„ BeanDefinition æ³¨å†Œè‡³ IOC å®¹å™¨ä¸­ã€‚å…¶ä¸­ BeanDefinitionRegistry æ˜¯ä¸€ä¸ª DefaultListableBeanFactory å³ BeanFactoryï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼šçœ‹åˆ°åƒ registry æ³¨å†Œ BeanDefinition çš„æ­¥éª¤ï¼Œå…¶å®å°±æ˜¯æŒ‡å‘ IOC å®¹å™¨æ³¨å†Œ BeanDefintionã€‚</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre v-pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">registerBeanDefinition</span><span class="token punctuation">(</span>
      <span class="token class-name">BeanDefinitionHolder</span> definitionHolder<span class="token punctuation">,</span> <span class="token class-name">BeanDefinitionRegistry</span> registry<span class="token punctuation">)</span>
      <span class="token keyword">throws</span> <span class="token class-name">BeanDefinitionStoreException</span> <span class="token punctuation">{</span>

    <span class="token comment">// è·å–è§£æçš„ &lt;bean>å…ƒç´  çš„ id å±æ€§</span>
    <span class="token class-name">String</span> beanName <span class="token operator">=</span> definitionHolder<span class="token punctuation">.</span><span class="token function">getBeanName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//å‘ IoCå®¹å™¨ æ³¨å†Œ BeanDefinitionå¯¹è±¡</span>
    registry<span class="token punctuation">.</span><span class="token function">registerBeanDefinition</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> definitionHolder<span class="token punctuation">.</span><span class="token function">getBeanDefinition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//å¦‚æœè§£æçš„ &lt;bean>å…ƒç´  æœ‰åˆ«åaliasï¼Œå‘å®¹å™¨ä¸­æ³¨å†Œåˆ«å</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>aliases <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> alias <span class="token operator">:</span> aliases<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        registry<span class="token punctuation">.</span><span class="token function">registerAlias</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> alias<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="defaultlistablebeanfactory-registerbeandefinition" tabindex="-1"><a class="header-anchor" href="#defaultlistablebeanfactory-registerbeandefinition"><span>DefaultListableBeanFactory#registerBeanDefinition</span></a></h6>
<p>BeanDefinitionRegistry æŒ‡çš„å…¶å®æ˜¯ DefaultListableBeanFactoryï¼Œæ‰€ä»¥æˆ‘ä»¬è·Ÿè¸ª DefaultListableBeanFactory å¯¹ registerBeanDefinition çš„å®ç°å³å¯ï¼ŒIOC å®¹å™¨ï¼ŒIOC å®¹å™¨ï¼Œæˆ‘ä»¬æ‰€è¯´çš„å®¹å™¨ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ª ConcurrentHashMap</p>
<ul>
<li>åœ¨æ³¨å†Œä¹‹å‰ï¼Œä¼šå…ˆå¯¹ä¼ å…¥çš„ BeanDefinition è¿›è¡Œæ ¡éªŒï¼Œä¸»è¦æ˜¯æ¥å£å’Œå·¥å‚æ–¹æ³•çš„æ ¡éªŒã€‚</li>
<li>ç„¶åä¼šå…ˆæ ¹æ® BeanName æŸ¥çœ‹å®¹å™¨ä¸­æ˜¯å¦æœ‰åŒå BeanDefinition
<ul>
<li>å¦‚æœæœ‰å…ˆåˆ¤æ–­æ˜¯å¦å…è®¸è¦†ç›–</li>
<li>æ ¹æ® Role åˆ¤æ–­ BeanDefinition çš„ä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§ä½çš„ä¼šæŠ¥å‡º warn çº§åˆ«æ—¥å¿—</li>
</ul>
</li>
<li>æœ€ç»ˆå°† BeanDefinition æ³¨å…¥è‡³å®¹å™¨ä¸­</li>
</ul>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre v-pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">registerBeanDefinition</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">BeanDefinition</span> beanDefinition<span class="token punctuation">)</span>
      <span class="token keyword">throws</span> <span class="token class-name">BeanDefinitionStoreException</span> <span class="token punctuation">{</span>

    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">hasText</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> <span class="token string">"Bean name must not be empty"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">notNull</span><span class="token punctuation">(</span>beanDefinition<span class="token punctuation">,</span> <span class="token string">"BeanDefinition must not be null"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//å…ˆæ ¡éªŒBeanDefinitionï¼Œæ ¡éªŒæ˜¯å¦å±äºæ¥å£ï¼Œæ˜¯å¦å±äºå·¥å‚æ–¹æ³•ï¼Œæ˜¯çš„è¯ä¸äºˆé€šè¿‡</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>beanDefinition <span class="token keyword">instanceof</span> <span class="token class-name">AbstractBeanDefinition</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">AbstractBeanDefinition</span><span class="token punctuation">)</span> beanDefinition<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">BeanDefinitionValidationException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BeanDefinitionStoreException</span><span class="token punctuation">(</span>beanDefinition<span class="token punctuation">.</span><span class="token function">getResourceDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> beanName<span class="token punctuation">,</span>
            <span class="token string">"Validation of bean definition failed"</span><span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//è¿™é‡Œç»´æŠ¤ç€ä¸€ä¸ªConcurrentHashMapï¼Œä»–å…¶å®å°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„IOCå®¹å™¨äº†ï¼Œæ²¡é”™ï¼ŒIOCå®¹å™¨æœ¬è´¨ä¸Šå°±æ˜¯ConcurrentHashMap</span>
    <span class="token comment">//private final Map&lt;String, BeanDefinition> beanDefinitionMap = new ConcurrentHashMap&lt;>(256);</span>
    <span class="token class-name">BeanDefinition</span> existingDefinition <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>beanDefinitionMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//å…ˆæ ¹æ®beanNameä»å®¹å™¨ä¸­æŸ¥æ‰¾ï¼Œçœ‹çœ‹æ˜¯å¦å…·æœ‰åŒåBeanDefinition</span>
    <span class="token comment">//çœ‹çœ‹è¯¥BeanDefinitionæ˜¯å¦å…è®¸è¦†ç›–ï¼Œå¦‚æœä¸å…è®¸ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>existingDefinition <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isAllowBeanDefinitionOverriding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BeanDefinitionOverrideException</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> beanDefinition<span class="token punctuation">,</span> existingDefinition<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">//ä¸ä»¥å¾€ç‰ˆæœ¬ç•¥æœ‰ä¸åŒï¼ŒSpring 5 æ–°å¢äº†BeanDefinition Role</span>
      <span class="token comment">//è¯¥Roleç”¨äºè¡¨ç¤ºBeanDefinitionçš„ä¼˜å…ˆçº§ï¼Œæ¯”å¦‚ROLE_APPLICATION æ˜¯åº”ç”¨äºAPPçš„Bean é‡è¦æ€§å¾ˆé«˜</span>
      <span class="token comment">//ROLE_SUPPORT æ ‡è¯†é…ç½®æ€§çš„Bean</span>
      <span class="token comment">//æ‰€ä»¥å¦‚æœæ–°å¢çš„BeanDefintionä¼˜å…ˆçº§æ²¡æœ‰ä»¥å¾€çš„é«˜ï¼Œé‚£ä¹ˆä¼šæ‰“å°æ—¥å¿—</span>
      <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>existingDefinition<span class="token punctuation">.</span><span class="token function">getRole</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> beanDefinition<span class="token punctuation">.</span><span class="token function">getRole</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isInfoEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"Overriding user-defined bean definition for bean '"</span> <span class="token operator">+</span> beanName <span class="token operator">+</span>
              <span class="token string">"' with a framework-generated bean definition: replacing ["</span> <span class="token operator">+</span>
              existingDefinition <span class="token operator">+</span> <span class="token string">"] with ["</span> <span class="token operator">+</span> beanDefinition <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token comment">//å¦‚æœå¼•å…¥çš„åŒåBeanDefinitionä¸å®¹å™¨å†…çš„ä¸ä¸€æ ·ï¼Œä¹Ÿä¼šæ‰“å°æ—¥å¿—</span>
      <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>beanDefinition<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>existingDefinition<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isDebugEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"Overriding bean definition for bean '"</span> <span class="token operator">+</span> beanName <span class="token operator">+</span>
              <span class="token string">"' with a different definition: replacing ["</span> <span class="token operator">+</span> existingDefinition <span class="token operator">+</span>
              <span class="token string">"] with ["</span> <span class="token operator">+</span> beanDefinition <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isTraceEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          logger<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">"Overriding bean definition for bean '"</span> <span class="token operator">+</span> beanName <span class="token operator">+</span>
              <span class="token string">"' with an equivalent definition: replacing ["</span> <span class="token operator">+</span> existingDefinition <span class="token operator">+</span>
              <span class="token string">"] with ["</span> <span class="token operator">+</span> beanDefinition <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token comment">//é™¤äº†ä¸å…è®¸è¦†ç›–çš„æƒ…å†µä¸‹ï¼Œå…¶ä»–æƒ…å†µæœ€ç»ˆéƒ½ä¼šè¦†ç›–äº†å…¶ä»–åŒåçš„BeanDefinition</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>beanDefinitionMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> beanDefinition<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">//Spring åœ¨ æ³¨å†Œé˜¶æ®µä¹Ÿåšäº†ä¸€å±‚ä¼˜åŒ–ï¼Œå³å¦‚æœBeanå·²ç»å¼€å§‹äº†åˆ›å»ºï¼Œæ‰ä¼šä¸Šé”</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasBeanCreationStarted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Cannot modify startup-time collection elements anymore (for stable iteration)</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>beanDefinitionMap<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>beanDefinitionMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> beanDefinition<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> updatedDefinitions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>beanDefinitionNames<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          updatedDefinitions<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>beanDefinitionNames<span class="token punctuation">)</span><span class="token punctuation">;</span>
          updatedDefinitions<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>beanDefinitionNames <span class="token operator">=</span> updatedDefinitions<span class="token punctuation">;</span>
          <span class="token function">removeManualSingletonName</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token comment">//BeanDefinitionè¿˜æ²¡åˆ›å»ºï¼Œåˆ™ç›´æ¥å¾€å®¹å™¨ä¸­æ³¨å†ŒBeanDefinition</span>
      <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// Still in startup registration phase</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>beanDefinitionMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> beanDefinition<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>beanDefinitionNames<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">removeManualSingletonName</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">//é‡ç½®ç¼“å­˜</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>frozenBeanDefinitionNames <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>existingDefinition <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token function">containsSingleton</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">resetBeanDefinition</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isConfigurationFrozen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">clearByTypeCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“"><span>æ€»ç»“</span></a></h3>
<p>å¥½äº†ï¼Œåˆ°äº†è¿™é‡Œï¼Œæˆ‘ä»¬å›è¿‡å¤´æ¥å°† Bean åˆ° BeanDefinition æ•´ä¸ªæµç¨‹æ‹ä¸€éï¼Œå¤§è‡´å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªé˜¶æ®µ</p>
<ol>
<li>
<p>XML é˜¶æ®µ </p>
<p>å®šä¹‰ XML</p>
</li>
<li>
<p>XmlBeanDefinitionReader é˜¶æ®µ</p>
<p>è¯»å–èµ„æº</p>
</li>
<li>
<p>DocumentLoader é˜¶æ®µ</p>
<p>å¤„ç†èµ„æºè‡³ Document</p>
</li>
<li>
<p>DefaultBeanDefinitionDocumentReader é˜¶æ®µ</p>
<p>è§£æ Document å¹¶æ³¨å†Œ BeanDefinition</p>
<ol>
<li>
<p>BeanDefinitionParserDelegate</p>
<p>Document è§£æ</p>
</li>
<li>
<p>BeanDefinitionReaderUtils </p>
<p>æ³¨å†Œ BeanDefinition è‡³å®¹å™¨</p>
</li>
</ol>
</li>
</ol>
<figure><img src="@source/backend/ssm/spring/image/image_eNoRyIkDm-.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>BeanDefinition è¿™ä¸ª Bean çš„èº«ä»½è¯å¯ä»¥è¯´æ˜¯å®Œæˆè§£æäº†ï¼Œä½†æ˜¯ Bean ä»æ˜¯æ²¡æœ‰è¯ç”Ÿåˆ°å®¹å™¨ä¸­çš„ ~~ï¼Œåœ¨è¿™ä¸ªç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬äº†è§£äº†ä¸€ä¸ªå®Œæ•´çš„ BeanDefinition ä»æœ€å¼€å§‹çš„ Xml bean æ ‡ç­¾åˆ° BeanDefinition ç±»çš„è¿‡ç¨‹ï¼Œåœ¨ Spring çš„è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¼šå‘ç°è¿™ä¸ªå˜åŒ–çš„è¿‡ç¨‹æ˜¯ä¸€ä¸ªå±‚å±‚é€’è¿›çš„è¿‡ç¨‹ï¼Œå°±å¥½åƒç°å®ç”Ÿäº§ä¸­çš„æµæ°´çº¿ä¸€æ ·ï¼Œè€Œä¸” Spring å°†æ¯ä¸ªç”Ÿæˆçš„éƒ¨åˆ†æˆ–è€…è¯´éƒ¨é—¨éƒ½åˆ†å¾—å¾ˆå‡†ç¡®ï¼Œå¯ä»¥è¯´æ˜¯åšåˆ°å„å¸å…¶èŒï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬åœ¨å¼€å‘çš„è¿‡ç¨‹ä¸­éœ€è¦å­¦ä¹ çš„ ï¼Œæ¯ä¸ªç±»/å·¥å…·ç±»/æœåŠ¡ç±»éƒ½åº”åšåˆ°èŒè´£éš”ç¦»ã€‚</p>
</div></template>


