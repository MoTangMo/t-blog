---
title: GLMçš„ä»‹ç»ä¸åœ¨çº¿è°ƒç”¨
icon: pen-to-square
date: 2025-4-20
star: true
sticky: true
category:
  - AI
tag:
  - GLM
  - AI
  - python
---

# GLMçš„ä»‹ç»ä¸åœ¨çº¿è°ƒç”¨

## ç›®å½•

- [æ³¨å†Œç”³è¯·](#æ³¨å†Œç”³è¯·)
- [APIä½¿ç”¨](#APIä½¿ç”¨)
  - [å®‰è£…ä¾èµ–](#å®‰è£…ä¾èµ–)
  - [åœ¨çº¿è°ƒç”¨](#åœ¨çº¿è°ƒç”¨)
    - [pythonç‰ˆæœ¬](#pythonç‰ˆæœ¬)
    - [javaç‰ˆæœ¬](#javaç‰ˆæœ¬)
    - [å“åº”è§£æ](#å“åº”è§£æ)
      - [token](#token)
      - [choice](#choice)
    - [å…¥å‚è§£æ](#å…¥å‚è§£æ)

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå„ç§å„æ ·çš„å¤§æ¨¡å‹æ˜¯å±‚å‡ºä¸ç©·äº†ï¼Œå…¶ä¸­å¹¿ä¸ºäººçŸ¥çš„Deepseekï¼ŒGPTï¼Œè¿˜æœ‰GLMï¼ŒClaudeï¼Œtongyiç­‰ç­‰ç­‰ç­‰ï¼Œ é‚£ä¹ˆæœ¬ç« èŠ‚ä¸»è¦æ˜¯å¸¦é¢†å¤§å®¶å°è¯•åœ¨çº¿è°ƒç”¨ä¸€ä¸‹è¿™ä¹ˆäº›ä¸ªå¤§æ¨¡å‹ï¼Œå…¶å®è®ºè°ƒç”¨çš„è¯ï¼Œå¤§æ¨¡å‹ä¹‹é—´æ˜¯å¤§å·®ä¸å·®çš„ï¼Œæ¦‚å¿µéƒ½éå¸¸ç›¸ä¼¼ï¼Œæ‰€ä»¥è¯¥ç« èŠ‚å°±å°è¯•åŸºäºGLMå¤§æ¨¡å‹æ¥åœ¨çº¿è°ƒç”¨è°ƒç”¨\~

### æ³¨å†Œç”³è¯·

[https://bigmodel.cn/console/overview](https://bigmodel.cn/console/overview "https://bigmodel.cn/console/overview")

é¦–å…ˆæ³¨å†Œæ™ºè°±AIå¼€æ”¾å¹³å°ï¼ŒGLMå¤§æ¨¡å‹å¯¹äºæ–°ç”¨æˆ·ä¼šæœ‰å¾ˆå¤šå¾ˆå¤šçš„tokenèµ é€ï¼Œè€Œä¸”è¿˜æœ‰å…è´¹çš„æ¨¡å‹å¯ä¾›æˆ‘ä»¬ä½¿ç”¨ï¼Œæ‰€ä»¥å¯¹äºæˆ‘ä»¬å­¦ä¹ æˆ–è€…è‡ªå·±å¼€å‘æ¥è¯´ï¼ŒGLMæ˜¯ä¸ªå¾ˆå¥½çš„é€‰æ‹©å–”\~

æ¨¡å‹ä»·æ ¼ï¼š[https://bigmodel.cn/pricing](https://bigmodel.cn/pricing "https://bigmodel.cn/pricing")

## APIä½¿ç”¨

[https://bigmodel.cn/dev/api/normal-model/glm-4](https://bigmodel.cn/dev/api/normal-model/glm-4 "https://bigmodel.cn/dev/api/normal-model/glm-4")

### å®‰è£…ä¾èµ–

ä¸ç®¡æ˜¯Javaè¿˜æ˜¯pythonéƒ½éœ€è¦å…ˆè¿›è¡Œä¾èµ–å®‰è£…ï¼Œæ‰èƒ½ä½¿ç”¨ï¼Œå¯¹äºJavaé¡¹ç›®æ¥è¯´ï¼Œéœ€è¦å¯¼å…¥ä¾èµ–

```xml 
<dependency>
    <groupId>cn.bigmodel.openapi</groupId>
    <artifactId>oapi-java-sdk</artifactId>
    <version>release-V4-2.3.2</version>
</dependency>
```


è€Œå¯¹äºpythonæ¥è¯´ï¼Œä¹Ÿéœ€è¦è¿›è¡Œä¾èµ–å®‰è£…

```python 
pip install zhipuai

##æ›´æ–°ä¾èµ–

pip install --upgrade zhipuai


```


### åœ¨çº¿è°ƒç”¨

æŸ¥çœ‹APIï¼š[https://bigmodel.cn/usercenter/proj-mgmt/apikeys](https://bigmodel.cn/usercenter/proj-mgmt/apikeys "https://bigmodel.cn/usercenter/proj-mgmt/apikeys")

ä½¿ç”¨èµ·æ¥å…¶å®éå¸¸ç®€å•ï¼Œç›´æ¥æ‹·è´ä»£ç ä½¿ç”¨å³å¯ï¼Œæ–‡æ¡£æ›´æ˜¯æä¾›äº†ä»£ç ç¤ºä¾‹ï¼Œå…³é”®æˆ‘ä»¬éœ€è¦äº†è§£APIçš„å„é¡¹å‚æ•°çš„å«ä¹‰ï¼Œè¿™å¯¹æˆ‘ä»¬å¯¹å¤§æ¨¡å‹çš„ä¼˜åŒ–æ˜¯èµ·åˆ°è‡³å…³ä½œç”¨çš„ï¼Œè€Œä¸”æ‰€æœ‰çš„å¤§æ¨¡å‹å‚æ•°ä»¥åŠæ–¹æ³•éƒ½åŸºæœ¬ä¸Šæ˜¯ä¸€æ ·çš„ã€‚

#### pythonç‰ˆæœ¬

```python 
from zhipuai import ZhipuAI
# åŸºäºæˆ‘ä»¬æä¾›çš„API Keyæ„å»ºå®¢æˆ·ç«¯
client = ZhipuAI(api_key="ä½ çš„API key") # å¡«å†™æ‚¨è‡ªå·±çš„APIKey
# åŸºäºå®¢æˆ·ç«¯è¿›è¡ŒèŠå¤©
response = client.chat.completions.create(
    model="GLM-4-Flash",  # å¡«å†™éœ€è¦è°ƒç”¨çš„æ¨¡å‹ç¼–ç 
    messages=[
        {"role": "user", "content": "1+1=å‡ "}
    ],
)
print(response.choices[0].message)
```


#### javaç‰ˆæœ¬

```java 
/**
* åŒæ­¥è°ƒç”¨
*/
private static void testInvoke() {
   List<ChatMessage> messages = new ArrayList<>();
   //æ„å»ºèŠå¤©ä¿¡æ¯
   ChatMessage chatMessage = new ChatMessage(ChatMessageRole.USER.value(), "1+1=å‡ ");
   messages.add(chatMessage);
   String requestId = String.format("YourRequestId-d%", System.currentTimeMillis());
   //å‘é€è¯·æ±‚
   ChatCompletionRequest chatCompletionRequest = ChatCompletionRequest.builder()
           .model(Constants.ModelChatGLM4)
           .stream(Boolean.FALSE)
           .invokeMethod(Constants.invokeMethod)
           .messages(messages)
           .requestId(requestId)
           .build();
   ModelApiResponse invokeModelApiResp = client.invokeModelApi(chatCompletionRequest);
   try {
       System.out.println("model output:" + mapper.writeValueAsString(invokeModelApiResp));
   } catch (JsonProcessingException e) {
       e.printStackTrace();
   }
}
```


#### å“åº”è§£æ

å½“æˆ‘ä»¬é€šè¿‡ä»¥ä¸Šä»£ç æ„å»ºäº†å®¢æˆ·ç«¯å¹¶å‘é€æ¶ˆæ¯è‡³å¤§æ¨¡å‹åï¼Œå¤§æ¨¡å‹ä¼šè¿”å›ä¸€ä¸ªresponseç»™æˆ‘ä»¬ï¼Œè¿™ä¸ªresponseå®åˆ™ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰“å°ä¸€ä¸‹responseçœ‹çœ‹å…¶å†…å«äº†ä»€ä¹ˆå†…å®¹ï¼Œå½“ç„¶å¦‚æœæ˜¯Javaçš„è¯ï¼Œç›´æ¥è¿›å…¥ModelApiResponse å¯¹è±¡å°±å¯ä»¥çœ‹åˆ°é‡Œé¢çš„å†…å®¹äº†

```python 
Completion(
model='GLM-4-Flash', 
created=1744531111, 
choices=[CompletionChoice(index=0, finish_reason='stop', message=CompletionMessage(content='1+1 ç­‰äº 2ã€‚', role='assistant', tool_calls=None))], 
request_id='', 
id='', 
usage=CompletionUsage(prompt_tokens=10, completion_tokens=12, total_tokens=22))

```


åœ¨ä»¥ä¸Šçš„å“åº”ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ç¨å¾®å…³æ³¨usageæè¿°çš„å†…å®¹ï¼Œè¿™é‡Œé¢å…¶å®å°±æ˜¯æè¿°ç€æˆ‘ä»¬çš„è¿™æ¬¡è¯·æ±‚çš„tokenä½¿ç”¨æƒ…å†µ

##### token

é‚£ä¹ˆä»€ä¹ˆæ˜¯tokenå‘¢ï¼Ÿ

åœ¨å¤§è¯­è¨€æ¨¡å‹ä¸­ï¼Œtokenæ˜¯æ–‡æœ¬çš„åŸºæœ¬å•ä½ï¼Œå› ä¸ºæˆ‘ä»¬è·Ÿæ¨¡å‹èŠå¤©è¿™ä¸­é—´å…¶å®å¹¶ä¸æ˜¯ç›´æ¥ä½¿ç”¨è‡ªç„¶è¯­è¨€èŠå¤©çš„ï¼Œæ¨¡å‹å…¶å®æ˜¯å°†æˆ‘ä»¬çš„è‡ªç„¶è¯­è¨€ï¼ˆè¾“å…¥çš„æ–‡æœ¬ï¼‰æ‹†åˆ†æˆä¸€ç³»åˆ—çš„tokenè¿›è¡Œå¤„ç†çš„ï¼Œtokenæ˜¯ä»€ä¹ˆæ ·çš„å½¢å¼ï¼Œå…·ä½“å–å†³äºæ¨¡å‹ä½¿ç”¨çš„åˆ†è¯æ–¹æ³•ã€‚

åœ¨usageè¿™ä¸ªå¯¹è±¡ä¸­ï¼Œæœ‰ç€è¿™æ¬¡å¯¹è¯æ‰€ä½¿ç”¨çš„tokenæƒ…å†µ

- completion\_tokens ï¼š è¡¨ç¤ºç”Ÿæˆçš„å›ç­”çš„tokenæ•°é‡
- prompt\_tokens ï¼š è¡¨ç¤ºè¾“å…¥ç»™æ¨¡å‹çš„promptå ç”¨tokenæ•°é‡ï¼Œå…¶å®å°±æ˜¯æˆ‘ä»¬ç»™çš„message.contentæ‰€å ç”¨çš„tokenæ•°é‡
- total\_token ï¼š æŒ‡çš„æ˜¯æœ¬æ¬¡å¯¹è¯æ€»å…±å ç”¨çš„tokenæ•°é‡ï¼Œæ˜¯è¾“å…¥å’Œè¾“å‡ºçš„tokenä¹‹å’Œ

```bash 
usage=CompletionUsage(prompt_tokens=10, completion_tokens=12, total_tokens=22)
```


##### choice

åœ¨responseä¸­æˆ‘ä»¬çœ‹åˆ°ä¸€ä¸ªchoicesé€‰é¡¹ï¼Œå…¶ä¸­é‡Œé¢åŒ…å«çš„æ˜¯ä¸€ä¸ªä¸ªçš„CompletionChoiceç»„æˆçš„åˆ—è¡¨ï¼Œé‡Œé¢çš„messageæ˜¯ä¸€ä¸ªç±»å‹ä¸ºCompletionMessageçš„å¯¹è±¡ï¼Œå…¶ä¸­contentå°±æ˜¯å¤§æ¨¡å‹é’ˆå¯¹æ­¤æ¬¡å¯¹è¯çš„ç­”æ¡ˆã€‚

```python 
choices=[CompletionChoice(index=0, finish_reason='stop', message=CompletionMessage(content='1+1 ç­‰äº 2ã€‚', role='assistant', tool_calls=None))], 

```


#### å…¥å‚è§£æ

ä¸ç®¡æ˜¯Javaè¿˜æ˜¯pythonï¼Œæˆ‘ä»¬éƒ½èƒ½å¤Ÿå‘ç°å…¶éœ€è¦æˆ‘ä»¬å¡«å…¥ä¸¤é¡¹é‡è¦å‚æ•°

- model - æ¨¡å‹

  æˆ‘ä»¬éœ€è¦å¯¹æ¥çš„å¤§æ¨¡å‹ï¼Œpythonä»£ç ä¸­æˆ‘ä»¬ç›´æ¥æŒ‡å®šçš„å­—ç¬¦ä¸²GLM-4-Flashï¼Œè€ŒJavaæä¾›çš„SDKåˆ™æ˜¯ä½¿ç”¨Constants.ModelChatGLM4
- message - æ¶ˆæ¯

  æˆ‘ä»¬è¦å‘é€çš„æ¶ˆæ¯ï¼Œæˆ‘ä»¬è¦æ¸…æ¥šå¤§æ¨¡å‹æ˜¯ä¸€ç§è¯­è¨€æ¨¡å‹ï¼Œæˆ‘ä»¬è·Ÿå¤§æ¨¡å‹å°±åƒèŠå¤©ä¸€æ ·ï¼Œæ‰€ä»¥messageå…¶å®å°±æ˜¯æˆ‘ä»¬è¦å‘é€ç»™å¤§æ¨¡å‹çš„èŠå¤©è¯­å¥

  ä¸è¿‡æˆ‘ä»¬çœ‹ä»£ç ä¼šå‘ç°ï¼Œmessageå®é™…ä¸Šæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œç›´æ¥çœ‹Javaå¯èƒ½æ²¡é‚£ä¹ˆå¯è§‚ï¼Œéœ€è¦è¿›å…¥ChatMessageè¿›è¡ŒæŸ¥çœ‹ï¼Œçœ‹pythonç‰ˆæœ¬çš„è¯ ï¼Œ æˆ‘ä»¬å°±èƒ½å‘ç°
  ```python 
  messages=[
          {"role": "user", "content": "1+1=å‡ "}
      ]
  ```

  å…¶ä¸­ä¸¤ä¸ªå‚æ•°
  - role è¡¨ç¤ºæ¶ˆæ¯çš„å‘é€è€…ï¼Œå…¶ä¸­å¯ä»¥æœ‰user ï¼Œ assistant ï¼Œ system  ï¼Œtool
    - user ï¼š æŒ‡çš„æ˜¯æˆ‘ä»¬ç”¨æˆ·
    - assistant ï¼š æŒ‡çš„æ˜¯å¤§æ¨¡å‹ï¼Œè¿™ä¸ªæˆ‘ä»¬å¯ä»¥å…³æ³¨ä¸€ä¸‹response.choicesä¸­çš„message.role&#x20;
      ```python 
      choices=[CompletionChoice(index=0, 
      finish_reason='stop', 
      message=CompletionMessage(content='1+1 ç­‰äº 2ã€‚', role='assistant', tool_calls=None))], 

      ```

    - system ï¼šæŒ‡çš„æ˜¯ç³»ç»Ÿå‚æ•°ï¼Œæ¯”å¦‚è¯´ ã€è¯·ä½¿ç”¨æç™½çš„è¯­æ°”è¿›è¡Œå¯¹è¯ã€‘ï¼Œé‚£ä¹ˆå¤§æ¨¡å‹åœ¨æ•´ä¸ªå¯¹è¯å‘¨æœŸå†…éƒ½ä¼šåŸºäºæç™½çš„è¯­è¨€è·Ÿæˆ‘ä»¬å¯¹è¯çš„
      ```python 
          messages=[
              {"role": "system", "content": "è¯·ä½¿ç”¨æç™½çš„è¯­æ°”ä¸æˆ‘å¯¹è¯"},
              {"role": "user", "content": "ä½œä¸€é¦–æè¿°ç°ä»£ç§‘æŠ€æ˜Œç››çš„åŸå¸‚é£å…‰"}
          ]
      ```

    - toolï¼šå·¥å…·å‡½æ•°è°ƒç”¨
  - content æˆ‘ä»¬èŠå¤©çš„å†…å®¹
    ä¸è¿‡ä¸ºä»€ä¹ˆmessageéœ€è¦æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œå…¶å®æ˜¯ä¸ºäº†è®©å¤§æ¨¡å‹èƒ½å¤Ÿå…·å¤‡ä¸€ä¸ªè¯†åˆ«ä¸Šä¸‹æ–‡çš„èƒ½åŠ›ï¼Œæ‰€ä»¥é‡‡ç”¨çš„è¿™ç§æ‰‹æ®µï¼Œå³æˆ‘ä»¬æ¯æ¬¡èŠå¤©éƒ½æ˜¯å¾€messageä¸­å»è¿½åŠ å†…å®¹ï¼Œç„¶åä¸€æ¬¡æ€§å°†messageæ‰”ç»™å¤§æ¨¡å‹ï¼Œé‚£å¤§æ¨¡å‹é€šè¿‡è¿™ä¸ªmessageåˆ—è¡¨å°±å¯ä»¥çŸ¥é“èŠå¤©å†å²è®°å½•äº†\~
  äº†è§£äº†è¿™ä¹ˆäº›å†…å®¹åï¼Œé‚£æˆ‘ä»¬å°±è¦æ¸…æ™°äº†ï¼Œåœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæƒ³è¦è®©å¤§æ¨¡å‹èƒ½å¤Ÿè¯†åˆ«ä¸Šä¸‹æ–‡ï¼Œæˆ‘ä»¬å¿…é¡»è¦æŠŠæˆ‘ä»¬ä¹‹å‰å‘é€çš„ä¿¡æ¯å’Œå¤§æ¨¡å‹å›ç­”çš„å†…å®¹åˆå¹¶ä¸€èµ·äº¤ç»™å¤§æ¨¡å‹ï¼Œè¿™æ ·å¤§æ¨¡å‹æ‰èƒ½å¤Ÿè¯†åˆ«ä¸Šä¸‹æ–‡çš„ï¼Œè¿™ä¹Ÿæ˜¯å¤§æ¨¡å‹èƒ½å¤Ÿè¯†åˆ«ä¸Šä¸‹æ–‡çš„åŸç†\~
  ```python 
  from zhipuai import ZhipuAI
  client = ZhipuAI(api_key="") # å¡«å†™æ‚¨è‡ªå·±çš„APIKey

  # å®šä¹‰ç³»ç»Ÿé…ç½®
  system_message =  {"role": "system", "content": "è¯·ä½¿ç”¨æç™½çš„è¯­æ°”ä¸æˆ‘å¯¹è¯"}

  messages = [
      system_message,
  ]

  # æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
  messages.append({"role": "user", "content": "è¯·ç»™æˆ‘è®²ä¸€ä¸ªç¬‘è¯"})

  response = client.chat.completions.create(
      model="GLM-4-Flash",  # å¡«å†™éœ€è¦è°ƒç”¨çš„æ¨¡å‹ç¼–ç 
      messages=messages
  )

  # å¾€messageå†…æ·»åŠ æ¨¡å‹çš„å›å¤ï¼Œä¸‹ä¸€æ¬¡ä¼šæŠŠmessageä¹Ÿå‘é€è‡³å¤§æ¨¡å‹ï¼Œå¤§æ¨¡å‹ä¾¿å…·å¤‡äº†è¯†åˆ«ä¸Šä¸‹æ–‡çš„èƒ½åŠ›äº†
  messages.append({"role": "assistant", "content": response.choices[0].message.content})


  print(response.choices[0].message.content)
  ```


å½“ç„¶é™¤äº†ä»¥ä¸Šè¿™äº›å‚æ•°ï¼Œè¿˜æœ‰ä¸€äº›æˆ‘ä»¬å¯èƒ½ä¼šç”¨åˆ°çš„å¯é€‰å‚æ•°

- do\_sample æ˜¯å¦å¯ç”¨é‡‡ç”¨ç­–ç•¥
- temperature å’Œ top\_p è°ƒèŠ‚ç”Ÿæˆæ–‡æœ¬çš„éšæœºæ€§å’Œå¤šæ ·æ€§ ï¼ˆé‡è¦ï¼‰
  - temperature &#x20;

    ç±»å‹ï¼šFloat ï¼Œ å–å€¼èŒƒå›´å¯ä»¥æ˜¯\[0.0 , 1.0 ] ,é»˜è®¤ä¸º 0.95&#x20;

    ä½œç”¨ï¼šæ§åˆ¶è¾“å‡ºçš„éšæœºæ€§ï¼Œæ¸©åº¦è¶Šæ¥è¿‘1.0ï¼Œå°±ä¼šä½¿å¾—è¾“å‡ºè¶Šå…·å¤‡åˆ›æ„æ€§å’Œå¤šæ ·æ€§ï¼Œæ¸©åº¦è¶Šæ¥è¿‘0.0ï¼Œåˆ™ä¼šä½¿å¾—è¾“å‡ºæ›´é›†ä¸­æ›´ç¡®å®šã€‚

    å…¶å®å¤§æ¨¡å‹çš„æœ¬è´¨å°±æ˜¯å°†æˆ‘ä»¬çš„è¯­è¨€é€šè¿‡å„è‡ªçš„è§„åˆ™è¿›è¡Œæ‹†åˆ†ï¼Œç„¶åå°†æ‹†åˆ†åçš„è¯­è¨€è¿›è¡ŒåŒ¹é…ï¼Œå¦‚æœæˆ‘ä»¬ç»™çš„temperature  è¶Šæ¥è¿‘1.0ï¼Œé‚£ä¹ˆå°±å…è®¸åŒ¹é…é€‰è¯çš„ç»“æœå°±èƒ½å¤Ÿç¨å¾®åä¸€ç‚¹ï¼Œå¦‚æœè¶Šæ¥è¿‘0.0 ï¼Œé‚£ä¹ˆå°±å…è®¸åŒ¹é…é€‰è¯çš„ç»“æœèƒ½å¤Ÿæ›´åŠ å‡†ç¡®ä¸€ç‚¹ã€‚

    æ‰€ä»¥å¯¹äºå®¢æœæ¨¡å‹æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥ç¨å¾®æ‹”é«˜ä¸€ç‚¹temperature  ï¼Œè€Œå¯¹äºæŠ€æœ¯æ–‡æ¡£è¿™ç§ä¸¥è°¨æ€§æ¯”è¾ƒé«˜çš„æˆ‘ä»¬å°±å¯ä»¥é™ä½ä¸€ç‚¹temperature  å‚æ•°äº†

    ![](image/image_csGkNS_mAG.png)
  - top\_p top\_pçš„è¯ï¼Œä»–éœ€è¦å°†do\_sample å‚æ•°è®¾ç½®ä¸ºtrueçš„ï¼Œè€Œä¸”top\_på’Œtemperature  ä¸¤è€…æœ‰æ—¶å€™æ­é…ä½¿ç”¨ä¼šä½¿å¾—å¤§æ¨¡å‹è¾“å‡ºçš„ç»“æœæŠ€èƒ½ä¿ç•™æ—¢å®šçš„å‡†ç¡®æ€§ä¹Ÿèƒ½æ‹¥æœ‰ä¸€ç‚¹çš„åˆ›æ„æ€§çš„\~

    ç±»å‹ï¼š Float ï¼Œ å–å€¼èŒƒå›´ä¸º\[0.0 ï¼Œ 1.0 ]

    ä½œç”¨ï¼štop\_p å’Œ temperature  è™½ç„¶éƒ½æ˜¯æ§åˆ¶é€‰è¯çš„æ¦‚ç‡ï¼Œä½†æ˜¯ä¸¤è€…çš„å¤„ç†æ˜¯ä¸ä¸€æ ·çš„ï¼Œtemperature  æ˜¯é€šè¿‡æ§åˆ¶ç”Ÿæˆé€‰è¯çš„æ¦‚ç‡åˆ†å¸ƒï¼Œæ¯”å¦‚è¯´**çŒ«ï¼ˆ90%ï¼‰ã€ç‹—ï¼ˆ9%ï¼‰ã€å…¶ä»–ï¼ˆ1%ï¼‰**ï¼Œè€Œtop\_påˆ™é€šè¿‡åŠ¨æ€è£å®šé€‰è¯æ¥æ§åˆ¶é€‰è¯çš„æ¦‚ç‡çš„ï¼Œæ¯”å¦‚è¯´ï¼Œå¤§æ¨¡å‹é€‰äº†**çŒ«ï¼ˆ50%ï¼‰ã€ç‹—ï¼ˆ30%ï¼‰ã€è±¡ï¼ˆ15%ï¼‰ã€èš‚èšï¼ˆ5%ï¼‰**ï¼Œå¦‚æœæˆ‘ä»¬è®¾ç½®äº†top\_pä¸º0.8 ï¼Œ é‚£ä¹ˆçŒ«å’Œç‹—çš„æ¦‚ç‡è¾¾åˆ°äº†0.8 ï¼Œè±¡å’Œèš‚èšå°±ä¸åœ¨æ˜¯é€‰è¯çš„èŒƒå›´å†…äº†ã€‚é€‰è¯çš„èŒƒå›´å°±åœ¨çŒ«å’Œç‹—ä¸¤ä¸ªè¯å½“ä¸­è¿›è¡Œé€‰æ‹©ï¼Œæ­¤æ—¶æ¦‚ç‡ä¼šé‡æ–°è®¡ç®—ï¼Œä¼šç®—å¾—çŒ«ï¼ˆ50% / 80% = 62.5%ï¼‰ ï¼Œ ç‹—ï¼ˆ30% / 80% = 37.5%ï¼‰&#x20;

    ![](image/image_XNF8Gud8FQ.png)
- stop å®šä¹‰ç”Ÿæˆè¿‡ç¨‹çš„ç»ˆæ­¢æ¡ä»¶
- max\_tokens é™åˆ¶ç”Ÿæˆæ–‡æœ¬çš„é•¿åº¦

  å¯ä»¥ç”¨æ¥æ§åˆ¶è¾“å‡ºæˆæœ¬ï¼Œæ¯”å¦‚è¯´å¦‚æœæˆ‘ä»¬åªéœ€è¦å¤§æ¨¡å‹å›å¤å•ä¸ªé€‰é¡¹ï¼ˆAã€Bã€Cï¼‰ï¼Œè¿™æ ·å°±è®©å¤§æ¨¡å‹ç›´æ¥å›å¤é€‰é¡¹å°±è¡Œï¼Œå°±æ²¡å¿…è¦å›å¤å…¶ä»–çš„å†…å®¹äº†ï¼Œè¿™æ ·ä¾¿èƒ½èŠ‚çœtokençš„æˆæœ¬ï¼Œæ¯•ç«Ÿéƒ½æ˜¯ğŸ’´é’±å‘\~
- stream æ§åˆ¶æ˜¯å¦ä»¥æµå¼çš„æ–¹å¼æ¥æ”¶ç”Ÿæˆçš„æ–‡æœ¬ ï¼ˆé‡è¦ï¼‰

  ä¸ºäº†æé«˜ç”¨æˆ·ä½“éªŒåº¦ï¼Œå¯ä»¥å°†streamè®¾ä¸ºtrueä»è€Œèƒ½å¤Ÿå®ç°æ‰“å­—æœºçš„æ•ˆæœè€Œä¸æ˜¯ç­‰å¤§æ¨¡å‹å‡ºç»“æœå†è¿›è¡Œè¾“å‡º
  ```python 
  from zhipuai import ZhipuAI
  client = ZhipuAI(api_key="") # å¡«å†™æ‚¨è‡ªå·±çš„APIKey

  # å®šä¹‰ç³»ç»Ÿé…ç½®
  system_message =  {"role": "system", "content": "è¯·ä½¿ç”¨æç™½çš„è¯­æ°”ä¸æˆ‘å¯¹è¯"}

  messages = [
      system_message,
  ]

  # æ·»åŠ ç”¨æˆ·ä¿¡æ¯
  messages.append({"role": "user", "content": "è¯·ç»™æˆ‘è®²ä¸€ä¸ªç¬‘è¯"})

  response = client.chat.completions.create(
      model="GLM-4-Flash",  # å¡«å†™éœ€è¦è°ƒç”¨çš„æ¨¡å‹ç¼–ç 
      messages=messages,
      stream=True # å¼€å¯streamæµå¼å“åº”
  )


  # è¾“å‡ºæµå¼ç»“æœ
  for chunk in response:
      if chunk.choices[0].delta.content:
          print(chunk.choices[0].delta.content, end="")
  ```

- tools , tool\_choice é…ç½®æ¨¡å‹å¯ä»¥è°ƒç”¨çš„å¤–éƒ¨å·¥å…·æˆ–å‡½æ•°

  toolsçš„æ„æ€æ˜¯å·¥å…·ï¼Œå…¶å®å°±æ˜¯è®©å¤§æ¨¡å‹çŸ¥é“æˆ‘ä»¬æ‹¥æœ‰å“ªäº›å·¥å…·åº“ï¼Œæ¯”å¦‚è¯´å‡½æ•°ç­‰ï¼Œè¯´ç™½äº†ï¼Œæˆ‘ä»¬è¦å°†æˆ‘ä»¬ç³»ç»Ÿæˆ–è€…ç¬¬ä¸‰æ–¹æä¾›çš„APIå‘ŠçŸ¥å¤§æ¨¡å‹ï¼Œå…¶ç›®çš„å°±åœ¨äºæˆ‘ä»¬å¯ä»¥é€šè¿‡è‡ªç„¶è¯­è¨€æ¥è¿›è¡Œå‡½æ•°è°ƒç”¨ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¹¶ä¸æ˜¯å¤§æ¨¡å‹å»è°ƒç”¨ï¼Œå¤§æ¨¡å‹å¯ä¸å…·å¤‡è¿™æ ·çš„åŠŸèƒ½å“ˆï¼Œå¤§æ¨¡å‹åªèƒ½å‘ŠçŸ¥æˆ‘ä»¬éœ€è¦è°ƒç”¨ä»€ä¹ˆå‡½æ•°ï¼Œå‚æ•°æ˜¯æ€ä¹ˆæ ·çš„ï¼Œè°ƒç”¨å‡½æ•°çš„äº‹æƒ…æ˜¯åº”ç”¨ç¨‹åºæ¥å®Œæˆçš„ã€‚

  ![](image/image_4-Zu3ck8wX.png)

  é¦–å…ˆæˆ‘ä»¬è¦æ¸…æ¥šå¤§æ¨¡å‹çš„ä¸¤å¤§ç¼ºé™·ï¼š
  1. å¹¶éçŸ¥æ™“ä¸€åˆ‡
     1. è®­ç»ƒæ•°æ®ä¸å¯èƒ½ä»€ä¹ˆéƒ½æœ‰
     2. ä¸çŸ¥é“æœ€æ–°ä¿¡æ¯ï¼Œå¤§æ¨¡å‹çš„è®­ç»ƒå‘¨æœŸå¾ˆé•¿ï¼Œæ›´æ–°ä¸€æ¬¡è€—èµ„å·¨å¤§ï¼Œå­˜åœ¨è¶Šè®­è¶Šå‚»çš„é£é™©
        1. GPT - 3.5 çŸ¥è¯†æˆªè‡³2021å¹´9æœˆ
        2. GPT - 4 - turbo çŸ¥è¯†æˆªè‡³2023å¹´12æœˆ
        3. GPT - 4o - mini çŸ¥è¯†æˆªè‡³2023å¹´10æœˆ
        4. GPT - 4o çŸ¥è¯†æˆªè‡³2023å¹´10æœˆ
  2. æ²¡æœ‰ã€çœŸé€»è¾‘ã€‘ï¼ˆè¿™æ˜¯æˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦toolsçš„åŸå› ï¼‰ï¼Œä»–è¡¨ç°å‡ºçš„é€»è¾‘ï¼Œæ¨ç†éƒ½æ˜¯è®­ç»ƒæ–‡æœ¬çš„ç»Ÿè®¡è§„å¾‹ï¼Œè€Œä¸æ˜¯çœŸæ­£çš„é€»è¾‘ï¼Œæ‰€ä»¥å¤§æ¨¡å‹å­˜åœ¨å¹»è§‰&#x20;
  > Function Calling ï¼š å¤§æ¨¡å‹éœ€è¦è¿æ¥çœŸå®ä¸–ç•Œï¼Œå¹¶å¯¹æ¥çœŸé€»è¾‘ç³»ç»Ÿæ‰§è¡Œç¡®å®šæ€§ä»»åŠ¡
  > æ—¢ç„¶å¤§æ¨¡å‹åŸºäºçš„éƒ½æ˜¯è®­ç»ƒè¿‡çš„æ•°æ®æ¥è¿›è¡Œæ€è€ƒä¸å›ç­”çš„ï¼Œæ‰€ä»¥å¯¹äºä¸€äº›å®æ—¶æ€§çš„é—®é¢˜ï¼Œæ¯”å¦‚ï¼šã€ä»Šå¤©æ˜¯ä»€ä¹ˆæ—¥å­ï¼Ÿã€‘
  ![](image/image_RADVzU0O7s.png)

  å¤§æ¨¡å‹æ˜¯å®Œå…¨æ— ä»å¾—çŸ¥ï¼Œè¿™å°±éœ€è¦æˆ‘ä»¬ç»™å¤§æ¨¡å‹æ­¦è£…æ­¦è£…å…¶å¤§è„‘äº†ğŸ§ ï¼Œæ€ä¹ˆåšå‘¢ï¼Ÿå…¶å®å°±æ˜¯è®©å¤§æ¨¡å‹å»æ¨æ–­åº”è¯¥è°ƒç”¨æˆ‘ä»¬æä¾›çš„ä»€ä¹ˆå‚æ•°æ¥è·å–ç»“æœé›†ï¼Œè¿™æ®µè¯æ€ä¹ˆç†è§£å‘¢ï¼Ÿæ•´ä¸ªæµç¨‹å¯ä»¥æ˜¯è¿™æ ·çš„

  æˆ‘é—®ã€ä»Šå¤©æ˜¯ä»€ä¹ˆæ—¥å­ï¼Ÿã€‘

  å¤§æ¨¡å‹æ¨ç†ã€éœ€è¦å…ˆè°ƒç”¨å‡½æ•°\[getToday]ã€‘

  åº”ç”¨ç¨‹åºã€è°ƒç”¨getTodayã€‘ç»“æœå–‚ç»™å¤§æ¨¡å‹  ï¼ˆå¦‚æœæ— éœ€å¯¹ç»“æœè¿›è¡Œæ¶¦è‰²ï¼Œé‚£åˆ°è¿™é‡Œä¾¿èƒ½ç»“æŸäº†ï¼Œå› ä¸ºåˆ°è¿™é‡Œå°±èƒ½å¾—åˆ°å‡½æ•°ç»“æœäº†ï¼‰

  å¤§æ¨¡å‹æ‹¿åˆ°ç»“æœè¿›ä¸€æ­¥æ¨ç†ç»™å‡ºç­”æ¡ˆ

  å¦‚ä½•è®©å¤§æ¨¡å‹è°ƒç”¨æˆ‘ä»¬é…ç½®å‡½æ•°å‘¢ï¼Ÿå…¶å®è·Ÿæˆ‘ä»¬è‡ªå·±è°ƒç”¨çš„æ–¹å¼æ˜¯ä¸€æ ·çš„ï¼Œå°±æ˜¯å‘Šè¯‰å¤§æ¨¡å‹æˆ‘ä»¬çš„åº”ç”¨æˆ–è€…è¯´å¯ä»¥è°ƒç”¨çš„åº”ç”¨æ¥å£éƒ½æœ‰å“ªäº›ï¼Œæˆ‘ä»¬è¦æè¿°æ¸…æ¥šï¼Œæè¿°çš„æ ¼å¼å¯ä»¥æ˜¯jsonæˆ–è€…ymlï¼Œæ¯”å¦‚è¯´ä»¥ä¸‹çš„æ ¼å¼
  ```python 
  #å®šä¹‰å¤§æ¨¡å‹çš„å‡½æ•°è°ƒç”¨
  tools = [
      {
          "type" : "function",
          "function" : { # å‡½æ•°ä¿¡æ¯é…ç½®
              "name " : "getDate",
              "description" : "è·å–ä»¥ä»Šå¤©ä¸ºå‡†åç§»åçš„æ—¥æœŸ",
              "parameters" : {
                  "type" : "object",
                  "properties" : { # å‚æ•°é¡¹
                      "offset" : {
                          "type" : "string",
                          "description" : "åç§»é‡"
                      }
                  },
                  "required" : ["offset"] # å¿…å¡«é¡¹
              }
          }

      }
  ]

  messages = [
  ]

  # æ·»åŠ ç”¨æˆ·ä¿¡æ¯
  messages.append({"role": "user", "content": "è·å–ä»Šå¤©çš„æ—¶é—´"})

  response = client.chat.completions.create(
      model="GLM-4-Flash",  # å¡«å†™éœ€è¦è°ƒç”¨çš„æ¨¡å‹ç¼–ç 
      messages=messages,
      tools=tools
  )


  print(response)


  # response ç»“æœ
  Completion(
  model='GLM-4-Flash', 
  created=1745125654, 
  choices=[
    CompletionChoice(index=0, finish_reason='tool_calls', 
    message=CompletionMessage(content=None, role='assistant', 
    tool_calls=[
      CompletionMessageToolCall(id='call_-8781449140955053157', 
        function=Function(arguments='{"offset": 0}', name='getDate'), 
        type='function', index=0)]))], request_id='20250420130733c19c2a6e1d8e46de', 
        id='20250420130733c19c2a6e1d8e46de', 
        usage=CompletionUsage(prompt_tokens=141, completion_tokens=9, total_tokens=150))


  ```

  è§‚å¯Ÿä»¥ä¸Šä»£ç å¾—å‡ºçš„responseï¼Œæ˜¾ç„¶å¤§æ¨¡å‹ç†è§£äº†æˆ‘æå‡ºçš„é—®é¢˜ã€è·å–ä»Šå¤©çš„æ—¶é—´ã€‘ï¼Œå¹¶è°ƒç”¨äº†toolsä¸­æˆ‘æä¾›çš„å‡½æ•°getDateï¼Œè§‚å¯Ÿresponseä¸­çš„tool\_callsï¼Œè¿™å½“ä¸­å°±åŒ…å«äº†å¤§æ¨¡å‹éœ€è¦æˆ‘ä»¬è°ƒç”¨çš„å‡½æ•°ã€‚

  æ‰€ä»¥æˆ‘ä»¬å®Œå…¨å¯ä»¥åŸºäºtool\_callsæ¥åˆ¤æ–­æˆ‘ä»¬æ˜¯å¦éœ€è¦è°ƒç”¨å‡½æ•°
  ```python 
  # å¦‚æœè¿”å›çš„æ˜¯å‚æ•°è°ƒç”¨ç»“æœ
  if(response.choices[0].message.tool_calls is not None):
      tool_call = response.choices[0].message.tool_calls[0]
      if(tool_call.function.name == "getDate"):
          args = tool_call.function.arguments
          # åº”ç”¨ç¨‹åºè°ƒç”¨å‡½æ•°ï¼Œè·å–ç»“æœ
          date = getDate(0)
          print(date) # ç»“æœ {'date': '2025/4/19'}
          # å¦‚æœéœ€è¦å°†ç»“æœäº¤ç»™å¤§æ¨¡å‹å¤„ç†ï¼Œåˆ™åŒ…è£…ä¸€ä¸ªä¿¡æ¯äº¤ç»™å¤§æ¨¡å‹,ä½†æ˜¯è¿™é‡Œçš„roleè¦æ³¨æ„
          # éœ€è¦æ›´æ¢æˆtooläº†ï¼Œä¸ºäº†å‘Šè¯‰å¤§æ¨¡å‹è¿™æ˜¯å‡½æ•°è°ƒç”¨çš„ç»“æœ
          messages.append({
              "tool_call_id" : tool_call.id,
              "role" : "tool",
              "name" : tool_call.function.name,
              "content" : json.dumps(date)
          })

          print(messages)
          response2 = client.chat.completions.create(
              model="GLM-4-Flash",
              messages=messages,
              tools=tools
          )

          print(response2.choices[0].message.content) #ç»“æœ ï¼šæ ¹æ®æ‚¨çš„æŸ¥è¯¢ï¼Œæˆ‘å·²ç»è°ƒç”¨äº†åä¸ºgetDateçš„APIæ¥è·å–ä»Šå¤©çš„æ—¶é—´ã€‚æ ¹æ®APIçš„è¿”å›ç»“æœï¼Œä»Šå¤©æ˜¯2025å¹´4æœˆ19æ—¥ã€‚



  ```

  é€šè¿‡è¿™æ ·ï¼Œæˆ‘ä»¬å°±èƒ½é€šè¿‡å¤§æ¨¡å‹æ¥å®Œæˆå‡½æ•°è°ƒç”¨ï¼Œå¯¹æ¥çœŸé€»è¾‘ä¸–ç•Œäº†\~ï¼Œä½†æ˜¯æœ‰ä¸€ç‚¹æˆ‘ä»¬éœ€è¦æ¸…æ¥šçš„æ˜¯ï¼Œæˆ‘ä»¬æ˜¯è®©å¤§æ¨¡å‹ç†è§£æˆ‘ä»¬è¾“å…¥çš„è¯­è¨€ä»è€Œå¾—åˆ°è°ƒç”¨å‡½æ•°çš„æ–¹æ¡ˆï¼Œæ‰€ä»¥ä»ç„¶ä¼šå­˜åœ¨å¤§æ¨¡å‹ç»™å‡ºé”™è¯¯ç­”æ¡ˆçš„æœºä¼šçš„ï¼Œè¿™å°±å–å†³äºå¤§æ¨¡å‹çš„ç†è§£èƒ½åŠ›äº†ã€‚

  æ³¨æ„ï¼štool\_callæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè¿™æ„å‘³ç€ï¼Œå¤§æ¨¡å‹å¯ä»¥ä¸ºæˆ‘ä»¬å›åº”ä¸€è¿ä¸²çš„å‡½æ•°è°ƒç”¨ï¼Œå³å¯ä»¥å¤šå‡½æ•°è°ƒç”¨ã€‚
- user\_id æä¾›ä¸€ä¸ªå”¯ä¸€æ ‡è¯†ç¬¦ä»¥ä»£è¡¨æœ€ç»ˆç”¨æˆ·ï¼Œå¢å¼ºå®‰å…¨æ€§å’Œç›‘æ§èƒ½åŠ›
